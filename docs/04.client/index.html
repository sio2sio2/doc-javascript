


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="es">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>4. Programación en el cliente (Webpack) &#8212; documentación de Javascript - 0.1</title>
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    
    <link rel="index" title="Índice" href="../genindex.html" />
    <link rel="search" title="Búsqueda" href="../search.html" />
    <link rel="next" title="5. Programación en el servidor" href="../05.server/index.html" />
    <link rel="prev" title="3.3. Módulos" href="../03.node/03.modulos.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="Índice General"
             accesskey="I">índice</a></li>
        <li class="right" >
          <a href="../05.server/index.html" title="5. Programación en el servidor"
             accesskey="N">siguiente</a> |</li>
        <li class="right" >
          <a href="../03.node/03.modulos.html" title="3.3. Módulos"
             accesskey="P">anterior</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">documentación de Javascript - 0.1</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="programacion-en-el-cliente-webpack">
<span id="webpack"></span><h1>4. Programación en el cliente (Webpack)<a class="headerlink" href="#programacion-en-el-cliente-webpack" title="Enlazar permanentemente con este título">¶</a></h1>
<p>La programacion en el cliente tiene la particularidad de que necesitamos generar
un aplicación resultante que los navegadores sean capaces de ejecutar. Eso
implica:</p>
<ul class="simple">
<li>Por lo general, componer un fichero <code class="docutils literal notranslate"><span class="pre">.js</span></code> único a partir de nuestro
desarrollo modulas que contenga todos los módulos de la aplicación y,
opcionalmente, las librerías de terceros que hayamos usado en ella.</li>
<li>Transpilar el código <em>Javascript</em> para obtener un código compatible con
un mayor número de navegadores.</li>
<li>Poder preprocesar código <abbr title="Syntactically Awesome Style Sheets">SASS</abbr> o <a class="reference external" href="http://lesscss.org/">Less</a> para obtener código <abbr title="Cascading Style Sheets">CSS</abbr>.</li>
</ul>
<p>Además de lo anterior, es recomendable:</p>
<ul class="simple">
<li>Añadir automáticamente las marcas <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/script">script</a> y <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/link">link</a> al <abbr title="HyperText Markup Language">HTML</abbr>.</li>
<li>Facilitar y agilizar las tareas de comprobación del código:<ul>
<li>automatizando todas las tareas anteriores cada vez que modificamos
el código fuente.</li>
<li>Levantando un servidor web que recargue la aplicación recompuesta cada vez
que obramos un cambio.</li>
</ul>
</li>
</ul>
<p>Existe varias alternativas para lograr este objetivo (<a class="reference external" href="https://gulpjs.com/">Gulp</a>+ <a class="reference external" href="http://browserify.org/">Browserify</a>
podría ser una de ellas), aunque aquí nos centraremos en analizar
<strong class="program">webpack</strong><a class="footnote-reference" href="#id14" id="id1">[1]</a>.</p>
<div class="section" id="instalacion">
<h2>4.1. Instalación<a class="headerlink" href="#instalacion" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Lo primero es <a class="reference internal" href="../03.node/01.nodejs.html#prep-workdir"><span class="std std-ref">preparar el directorio de trabajo</span></a> para
después:</p>
<div class="section" id="paquetes">
<h3>4.1.1. Paquetes<a class="headerlink" href="#paquetes" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Para todo lo que pretendemos necesitamos al menos los siguientes paquetes:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> npm install --save-dev webpack webpack-dev-server webpack-cli webpack-merge
</pre></div>
</div>
</div>
<div class="section" id="bases-la-de-configuracion">
<h3>4.1.2. Bases la de configuración<a class="headerlink" href="#bases-la-de-configuracion" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Como nuestro objetivo es utilizar <strong class="program">webpack</strong> como aglutinante de nuestro
código, debemos añadir a <code class="file docutils literal notranslate"><span class="pre">package.json</span></code> los siguientes scripts:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;script&quot;</span><span class="o">:</span> <span class="p">{</span>
   <span class="s2">&quot;build&quot;</span><span class="o">:</span> <span class="s2">&quot;webpack --mode production&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Por otra parte, necesitamos un fichero para la configuración de
<strong class="program">webpack</strong> llamado <code class="file docutils literal notranslate"><span class="pre">webpack.config.js</span></code> con una primera
configuración como ésta:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">config</span> <span class="o">=</span> <span class="p">{</span>
   <span class="nx">entry</span><span class="o">:</span> <span class="s2">&quot;./src/js/index.js&quot;</span><span class="p">,</span>
   <span class="nx">output</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">filename</span><span class="o">:</span> <span class="s2">&quot;js/[name].bundle.js&quot;</span>
   <span class="p">}</span>
<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">config</span>
</pre></div>
</div>
<p>Esta configuración simplicísima supone que el punto de entrada de nuestra
aplicación es <code class="file docutils literal notranslate"><span class="pre">src/js/index.js</span></code> y que el resultado de la acción de
<strong class="program">webpack</strong> se guardará en <code class="file docutils literal notranslate"><span class="pre">dist/js/main.bundle.js</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">La configuración hace más de lo que aparenta. No sólo copia el
fichero, sino que lo minimiza; y, si hemos descompuesto nuestro código en
varios ficheros (<a class="reference internal" href="../03.node/03.modulos.html#js-modules"><span class="std std-ref">módulos</span></a>) que se llaman entre sí o
importa librerías de terceros, reunirá todo dentro del mismo fichero.
Para excluir módulos del fichero resultante único, consulte más adelante
<a class="reference internal" href="#webpack-externals"><span class="std std-ref">externals</span></a>.</p>
</div>
<p>El por qué el indicado es el fichero resultante se debe a dos razones:</p>
<ul>
<li><p class="first">Sin configuración adicional, se toma como directorio de resultados
<code class="file docutils literal notranslate"><span class="pre">/dist</span></code>. Veremos más adelante cómo alterar esto.</p>
</li>
<li><p class="first">El nombre es «<em>main</em>», porque la línea que define la entrada es:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">entry</span><span class="o">:</span> <span class="s2">&quot;./src.js/index.js&quot;</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="first admonition-title">Ver también</p>
<p class="last">Consulte el apartado sobre <a class="reference internal" href="#webpack-entry-point"><span class="std std-ref">la definición del punto de
entrada</span></a> para una explicación del hecho.</p>
</div>
</li>
</ul>
<p>Por último, debemos crear un código de ejemplo en <code class="file docutils literal notranslate"><span class="pre">src/js/index.js</span></code>:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">foobar</span> <span class="o">=</span> <span class="p">(</span><span class="nx">text</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
   <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">text</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">let</span> <span class="nx">mensaje</span> <span class="o">=</span> <span class="s2">&quot;Esto es una prueba&quot;</span><span class="p">;</span>
<span class="nx">foobar</span><span class="p">(</span><span class="nx">mensaje</span><span class="p">);</span>
</pre></div>
</div>
<p>en que usamos algunas características nuevas de <em>Javascript</em> para ilustrar más
adelante la transpilación con <a class="reference internal" href="#babel"><span class="std std-ref">babel</span></a>. Escrito el fichero podemos
obtener el resultado con:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ npm run build
</pre></div>
</div>
<p>que creará el fichero <code class="file docutils literal notranslate"><span class="pre">dist/js/main.bundle.js</span></code>. Si le echamos un vistazo
veremos que el código se encuentra ofuscado y minimizado.</p>
</div>
<div class="section" id="desarrollo">
<h3>4.1.3. Desarrollo<a class="headerlink" href="#desarrollo" title="Enlazar permanentemente con este título">¶</a></h3>
<p>La configuración anterior es un ejemplo tan simple que carece por completo de
utilidad, ya que hace inviable la corrección y depuración del código. Es
necesario, crear al menos dos configuraciones: una apropiada para generar el
resultado para producción y otra para generar un resultado apto para depurar
durante el desarrollo. Para ello vamos a crear así los <em>scripts</em> en
<code class="file docutils literal notranslate"><span class="pre">packages.json</span></code>:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;scripts&quot;</span><span class="o">:</span> <span class="p">{</span>
  <span class="s2">&quot;build&quot;</span><span class="o">:</span> <span class="s2">&quot;webpack --config webpack/webpack.production.js&quot;</span><span class="p">,</span>
  <span class="s2">&quot;watch&quot;</span><span class="o">:</span> <span class="s2">&quot;webpack --config webpack/webpack.development.js --watch&quot;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>cuyo sentido es el siguiente:</p>
<ul class="simple">
<li><code class="code docutils literal notranslate"><span class="pre">build</span></code> compone el resultado para usarlo en producción.</li>
<li><code class="code docutils literal notranslate"><span class="pre">watch</span></code> compone el resultado para usarlo mientras desarrollamos,
de modo que se queda expectante a cualquier cambio posterior que hagamos
para recomponer sobre la marcha el resultado.</li>
</ul>
<p>Dentro del directorio de trabajo, debemos también crear un directorio de
configuración para <strong class="program">webpack</strong> con el siguiente contenido:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>+ webpack
     +-- webpack.common.js
     +-- webpack.production.js
     +-- webpack.development.js
</pre></div>
</div>
<p><code class="file docutils literal notranslate"><span class="pre">webpack.common.js</span></code> contendrá lo siguiente:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">config</span> <span class="o">=</span> <span class="p">{</span>
   <span class="nx">entry</span><span class="o">:</span> <span class="s2">&quot;./src/js/index.js&quot;</span><span class="p">,</span>
   <span class="nx">output</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">filename</span><span class="o">:</span> <span class="s2">&quot;js/[name].bundle.js&quot;</span>
   <span class="p">}</span>
<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">config</span>
</pre></div>
</div>
<p><code class="file docutils literal notranslate"><span class="pre">webpack.production.js</span></code> esto:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">merge</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;webpack-merge&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">common</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./webpack.common.js&#39;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">config</span> <span class="o">=</span> <span class="nx">merge</span><span class="p">(</span><span class="nx">common</span><span class="p">,</span> <span class="p">{</span>
   <span class="nx">mode</span><span class="o">:</span> <span class="s2">&quot;production&quot;</span><span class="p">,</span>
<span class="p">});</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">config</span>
</pre></div>
</div>
<p>y, por su parte, <code class="file docutils literal notranslate"><span class="pre">webpack.development.js</span></code> esto otro:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">merge</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;webpack-merge&#39;</span><span class="p">),</span>
      <span class="nx">common</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./webpack.common.js&#39;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">config</span> <span class="o">=</span> <span class="nx">merge</span><span class="p">(</span><span class="nx">common</span><span class="p">,</span> <span class="p">{</span>
   <span class="nx">mode</span><span class="o">:</span> <span class="s2">&quot;development&quot;</span><span class="p">,</span>
   <span class="nx">devtool</span><span class="o">:</span> <span class="s1">&#39;inline-source-map&#39;</span>
<span class="p">});</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">config</span>
</pre></div>
</div>
<p>Con ello, además del script <code class="docutils literal notranslate"><span class="pre">build</span></code> podemos hacer:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ npm run watch
</pre></div>
</div>
<p>que creará el fichero pero se quedará vigilando cualquier cambio en el fichero
fuente para regenerarlo inmediatamente.</p>
</div>
<div class="section" id="aplicacion-simple">
<h3>4.1.4. Aplicación simple<a class="headerlink" href="#aplicacion-simple" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Trataremos ahora de montar una aplicación (bastante inútil, todo sea dicho) que
incluya <abbr title="HyperText Markup Language">HTML</abbr> y <abbr title="Cascading Style Sheets">CSS</abbr> y montarla con <strong class="program">webpack</strong>. En este caso, como se
obtiene como resultado una página web, tiene sentido poder depurar la página de
modo interactivo, esto es, que se levante un servidor web y que la página cambie
automáticamente al realizarse algún cambio en alguno de los ficheros fuente.
Para ello, añadimos un tercer <em>script</em>:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;debug&quot;</span><span class="o">:</span> <span class="s2">&quot;webpack-dev-server --config webpack/webpack.development.js&quot;</span>
</pre></div>
</div>
<p>El código fuente se compone de los siguientes ficheros:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>src
 +-- index.html
 |
 +-- js
 |    +-- index.js
 |
 +-- css
      +-- main.css
</pre></div>
</div>
<p>En este caso, deberemos instalar paquetes adicionales:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> npm install --save-dev html-loader html-webpack-plugin
<span class="gp">$</span> npm install --save-dev css-loader mini-css-extract-plugin
<span class="gp">$</span> npm install --save-dev url-loader file-loader
</pre></div>
</div>
<p>Para el <em>script</em> podemos usar el ya escrito, con la adición de una línea que
posibilita el procesamiento del <abbr title="Cascading Style Sheets">CSS</abbr>:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;use strict&quot;</span><span class="p">;</span>

<span class="hll"><span class="kr">import</span> <span class="s2">&quot;../css/main.css&quot;</span><span class="p">;</span>
</span>

<span class="kr">const</span> <span class="nx">foobar</span> <span class="o">=</span> <span class="p">(</span><span class="nx">text</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
   <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">text</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">let</span> <span class="nx">mensaje</span> <span class="o">=</span> <span class="s2">&quot;Esto es una prueba&quot;</span><span class="p">;</span>
<span class="nx">foobar</span><span class="p">(</span><span class="nx">mensaje</span><span class="p">);</span>
<span class="nx">no_existe</span><span class="p">();</span>  <span class="c1">// Esto debe provocar un error en la consola.</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p>Hay otra forma de provocar que se procese el fichero <abbr title="Cascading Style Sheets">CSS</abbr> (o
cualquier otro tipo de fichero): añadirlo al punto de entrada de
<strong class="program">webpack</strong>:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">entry</span><span class="o">:</span> <span class="p">[</span> <span class="s2">&quot;./src/js/index.js&quot;</span><span class="p">,</span> <span class="s2">&quot;./css/main.css&quot;</span> <span class="p">]</span>
</pre></div>
</div>
<p class="last">Esta alternativa puede ser interesante, si el <abbr title="Cascading Style Sheets">CSS</abbr> procede de código ajeno y
pretendemos crear una configuración condicional que incluya o no en los
ficheros resultantes el código de terceros. Más adelante, puede echarle un
vistazo al <a class="reference internal" href="#webpack-ej-plugin"><span class="std std-ref">ejemplo de construcción de un plugin</span></a> en
que se usa esta técnica. La contraprestación es que la dependencia no está
contenida en el código fuente y, en consecuencia, sólo es patente si se
procesa el desarrollo con <strong class="program">webpack</strong>.</p>
</div>
<p>Hay, ademas, que modificar imperiosamente <code class="file docutils literal notranslate"><span class="pre">webpack/webpack.development.js</span></code> para
alterar el comportamiento de <strong class="program">webpack-dev-server</strong>:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">merge</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;webpack-merge&#39;</span><span class="p">),</span>
      <span class="nx">common</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./webpack.common.js&#39;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">config</span> <span class="o">=</span> <span class="nx">merge</span><span class="p">(</span><span class="nx">common</span><span class="p">,</span> <span class="p">{</span>
   <span class="nx">mode</span><span class="o">:</span> <span class="s2">&quot;development&quot;</span><span class="p">,</span>
<span class="hll">   <span class="nx">devServer</span><span class="o">:</span> <span class="p">{</span>
</span><span class="hll">      <span class="nx">contentBase</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span><span class="hll">      <span class="nx">open</span><span class="o">:</span> <span class="s2">&quot;chromium&quot;</span>
</span><span class="hll">   <span class="p">},</span>
</span>   <span class="nx">devtool</span><span class="o">:</span> <span class="s1">&#39;inline-source-map&#39;</span>
<span class="p">});</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">config</span>
</pre></div>
</div>
<p>Para entender esta configuración, es indispensable conocer cómo funciona, en
realidad, <strong class="program">webpack-dev-server</strong>: en principio, sirve desde un directorio
virtual creado en la memoria los ficheros resultantes del procesamiento. En
consecuencia, ni tales ficheros resultantes se escriben en disco ni los ficheros
de disco están disponibles en el servidor web levantado. Ahora bien, la opción
<em>contentBase</em>, permite indicar un directorio del sistema real de ficheros  que
se fusionará con este directorio virtual a fin de que sus contenidos sí sean
accesibles. Si el valor es <code class="docutils literal notranslate"><span class="pre">false</span></code>, como es el caso, sólo se sirven los
ficheros del directorio virtual (o sea, sólo los ficheros resultantes del
procesamiento). Su valor predeterminado es <code class="file docutils literal notranslate"><span class="pre">dist/</span></code>, así que si no se
incluye la opción, estará accesible el contenido de este directorio en caso de
existir. Por supuesto, podemos establecer el valor que queramos, por ejemplo:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">contentBase</span><span class="o">:</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;path&quot;</span><span class="p">).</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s2">&quot;..&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>En este caso, fusionaremos todo el contenido del directorio de trabajo<a class="footnote-reference" href="#id15" id="id2">[2]</a> con
los ficheros resultantes. La otra opción, <em>open</em>, rige qué se hace al levantar el
servidor:</p>
<ul>
<li><p class="first">Si es <code class="docutils literal notranslate"><span class="pre">false</span></code>, que es su valor predeterminado al no haber incluido el
argumento <code class="code docutils literal notranslate"><span class="pre">--open</span></code><a class="footnote-reference" href="#id16" id="id3">[3]</a> en el <em>script</em> añadido a <code class="file docutils literal notranslate"><span class="pre">package.json</span></code>, no
se abre una ventana con la aplicación en el navegador, así que tendremos que
abri manualmente nosotros la aplicación en:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8080</span>
</pre></div>
</div>
</li>
<li><p class="first">Si toma valor, debe ser una cadena que indique el navegador con el que se
quiere ver la aplicación.</p>
</li>
<li><p class="first">Si es <code class="docutils literal notranslate"><span class="pre">true</span></code>, se usa el navegador predefinido por el sistema<a class="footnote-reference" href="#id17" id="id4">[4]</a>.</p>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p>Aunque tenga un interés muy relativo, también es posible hacer
que los ficheros resultantes se escriban en disco.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">devServer</span><span class="o">:</span> <span class="p">{</span>
   <span class="nx">writeToDisk</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
   <span class="nx">contentBase</span><span class="o">:</span> <span class="kc">false</span>
   <span class="nx">open</span><span class="o">:</span> <span class="s2">&quot;chromium&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p class="last">En este caso, se escribirán los ficheros resultantes en <code class="file docutils literal notranslate"><span class="pre">dist</span></code> (a menos
que lo modifiquemos) y el servidor publicará el contenido de este directorio.</p>
</div>
<p>Por su parte, <code class="file docutils literal notranslate"><span class="pre">index.html</span></code> puede ser el siguiente:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;es&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Aplicación simple<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Aplicación simple<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>Obsérvese que es necesario incluir las etiquetas <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/head">&lt;head&gt;</a> y <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/body">&lt;body&gt;</a> para el
plugin <strong class="program">HtmlWebpackPlugin</strong> inserte correctamente el <em>script</em> dentro del
<abbr title="HyperText Markup Language">HTML</abbr>. Por otro lado. el <abbr title="Cascading Style Sheets">CSS</abbr> es éste:</p>
<div class="highlight-css notranslate"><div class="highlight"><pre><span></span><span class="nt">body</span> <span class="p">{</span>
   <span class="n">blackground-color</span><span class="p">:</span> <span class="kc">yellow</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Como puede verse, no hay referencia en el <abbr title="HyperText Markup Language">HTML</abbr> ni al <em>script</em> ni a la hoja de
estilos, ya que se pretende que <strong class="program">webpack</strong> se encargue de incorpar las
referencias pertinentes. La configuración, en este caso, debe añadirse a
<code class="file docutils literal notranslate"><span class="pre">webpack/webpack.common.js</span></code>, ya que tanto en producción como en
desarrollo se tendrá que llevar a cabo la tarea:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">HtmlWebPackPlugin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;html-webpack-plugin&quot;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">MiniCssExtractPlugin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;mini-css-extract-plugin&quot;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">config</span> <span class="o">=</span> <span class="p">{</span>
   <span class="nx">entry</span><span class="o">:</span> <span class="s2">&quot;./src/js/index.js&quot;</span><span class="p">,</span>
   <span class="nx">output</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">filename</span><span class="o">:</span> <span class="s2">&quot;js/[name].bundle.js&quot;</span>
   <span class="p">},</span>
   <span class="nx">module</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">rules</span><span class="o">:</span> <span class="p">[</span>
         <span class="p">{</span>
            <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.html$/</span><span class="p">,</span>
            <span class="nx">use</span><span class="o">:</span> <span class="p">{</span>
               <span class="nx">loader</span><span class="o">:</span> <span class="s2">&quot;html-loader&quot;</span><span class="p">,</span>
               <span class="nx">options</span><span class="o">:</span> <span class="p">{</span> <span class="nx">minimize</span><span class="o">:</span> <span class="kc">true</span> <span class="p">}</span>
            <span class="p">}</span>
         <span class="p">},</span>
         <span class="p">{</span>
            <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.css$/</span><span class="p">,</span>
            <span class="nx">use</span><span class="o">:</span> <span class="p">[</span><span class="nx">MiniCssExtractPlugin</span><span class="p">.</span><span class="nx">loader</span><span class="p">,</span>
                  <span class="s2">&quot;css-loader&quot;</span><span class="p">]</span>
         <span class="p">}</span>
      <span class="p">]</span>
   <span class="p">},</span>
   <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
      <span class="k">new</span> <span class="nx">HtmlWebPackPlugin</span><span class="p">({</span>
         <span class="nx">template</span><span class="o">:</span> <span class="s2">&quot;src/index.html&quot;</span><span class="p">,</span>
         <span class="c1">//filename: &quot;index.html&quot;   // Es el valor predeterminado</span>
      <span class="p">}),</span>
      <span class="k">new</span> <span class="nx">MiniCssExtractPlugin</span><span class="p">({</span>
         <span class="nx">filename</span><span class="o">:</span> <span class="s2">&quot;css/[name].css&quot;</span><span class="p">,</span>
         <span class="nx">chunkFilename</span><span class="o">:</span> <span class="s2">&quot;[id].css&quot;</span>
      <span class="p">})</span>
   <span class="p">]</span>
<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">config</span>
</pre></div>
</div>
<p>Podemos ahora generar el resultado con:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ npm run build
</pre></div>
</div>
<p>pero como en esta ocasión sí tenemos un <abbr title="HyperText Markup Language">HTML</abbr>, podría interesarnos levantar un
servidor web y recargar la aplicación cada vez que hagamos un cambio en el
código fuente:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ npm run debug
</pre></div>
</div>
<p>Además, gracias a que hemos incluido la línea:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">devtool</span><span class="p">:</span> <span class="s1">&#39;inline-source-map&#39;</span>
</pre></div>
</div>
<p>los errores que genere la ejecución del código (en nuestro ejemplo hemos
incluido una línea que hace referencia a una función inexistente) referirán los
ficheros originales (<code class="file docutils literal notranslate"><span class="pre">src/js/index.js</span></code>) e incluso podremos fijar sobre
ellos puntos de ruptura para llevar a cabo la depuración del código.</p>
<p>Por defecto, los mapeos se escriben como comentarios dentro de los propios
ficheros <code class="docutils literal notranslate"><span class="pre">.js</span></code>. Podemos hacer que se escriban en fichero aparte modificando
la configuración:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">merge</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;webpack-merge&#39;</span><span class="p">),</span>
      <span class="nx">common</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./webpack.common.js&#39;</span><span class="p">),</span>
      <span class="nx">webpack</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;webpack&quot;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">config</span> <span class="o">=</span> <span class="nx">merge</span><span class="p">(</span><span class="nx">common</span><span class="p">,</span> <span class="p">{</span>
   <span class="nx">mode</span><span class="o">:</span> <span class="s2">&quot;development&quot;</span><span class="p">,</span>
   <span class="nx">devtool</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
   <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
      <span class="k">new</span> <span class="nx">webpack</span><span class="p">.</span><span class="nx">SourceMapDevToolPlugin</span><span class="p">({</span>
         <span class="nx">filename</span><span class="o">:</span> <span class="s1">&#39;js/[name].js.map&#39;</span>
      <span class="p">})</span>
   <span class="p">]</span>
<span class="p">});</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">config</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="particularidades">
<h2>4.2. Particularidades<a class="headerlink" href="#particularidades" title="Enlazar permanentemente con este título">¶</a></h2>
<div class="section" id="cambiando-rutas">
<span id="webpack-paths"></span><h3>4.2.1. Cambiando rutas<a class="headerlink" href="#cambiando-rutas" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Si no se definen rutas, <strong class="program">webpack</strong> entiende que la fuente del código es
el directorio de trabajo y que los ficheros resultantes los debe guardar dentro
del directorio <code class="file docutils literal notranslate"><span class="pre">dist</span></code>. Para cambiar esto último, no obstante, se puede
hacer:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="kr">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;path&quot;</span><span class="p">);</span>
</span><span class="hll"><span class="kr">const</span> <span class="nx">distDir</span> <span class="o">=</span> <span class="s2">&quot;dist&quot;</span><span class="p">;</span>
</span>
<span class="kr">const</span> <span class="nx">config</span> <span class="o">=</span> <span class="p">{</span>
   <span class="nx">entry</span><span class="o">:</span> <span class="s2">&quot;./src/js/index.js&quot;</span><span class="p">,</span>
   <span class="nx">output</span><span class="o">:</span> <span class="p">{</span>
<span class="hll">      <span class="nx">path</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="nx">distDir</span><span class="p">),</span>
</span>      <span class="nx">filename</span><span class="o">:</span> <span class="s2">&quot;js/[name].bundle.js&quot;</span>
   <span class="p">}</span>
<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">config</span>
</pre></div>
</div>
</div>
<div class="section" id="punto-de-entrada">
<span id="webpack-entry-point"></span><h3>4.2.2. Punto de entrada<a class="headerlink" href="#punto-de-entrada" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Hasta ahora hemos definido el punto de entrada de la manera más simple posible:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">entry</span><span class="o">:</span> <span class="s2">&quot;./src/js/index.js&quot;</span>
</pre></div>
</div>
<p>que equivale a:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">entry</span><span class="o">:</span> <span class="p">{</span>
   <span class="nx">main</span><span class="o">:</span> <span class="s2">&quot;./src/js/index.js&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Esta equivalencia es la que provoca que para <strong class="program">webpack</strong> <code class="docutils literal notranslate"><span class="pre">[name]</span></code> se
sustituya por <em>main</em>, por lo que:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">output</span><span class="o">:</span> <span class="p">{</span>
   <span class="nx">filename</span><span class="o">:</span> <span class="s2">&quot;js/[name].bundle.js&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>provoca que el fichero de salida sea <code class="file docutils literal notranslate"><span class="pre">js/main.bundle.js</span></code> (dentro de
<code class="file docutils literal notranslate"><span class="pre">dist/</span></code>, por supuesto). Como ya se ha explicado, este fichero no contiene
únicamente el punto de entrada <code class="file docutils literal notranslate"><span class="pre">src/js/index.js</span></code>, sino que cualquier
script en javascript que se importe dentro de él y, a se vez, los importados por
los importados, pasarán a formar parte de este fichero resultante. Los ficheros
de otra naturaleza importados en el propio código <em>Javascript</em> o a través del
código <abbr title="HyperText Markup Language">HTML</abbr> o <abbr title="Cascading Style Sheets">CSS</abbr> de la aplicación también se procesarán pero para ello será
necesario el uso de plugins y cargadores (como ya se ha practicado) y,
obviamente, el resultado acabará en otros ficheros distintos.</p>
<p>Por tanto, una primera variante es alternar ese nombre predeterminado para
que <code class="docutils literal notranslate"><span class="pre">[name]</span></code> cambie a otro valor más apropiado:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">entry</span><span class="o">:</span> <span class="p">{</span>
   <span class="s2">&quot;leaflet.mipluginmolon&quot;</span><span class="o">:</span> <span class="s2">&quot;./src/js/index.js&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>AHora bien, esto no acaba aquí. Si estamos desarrollando una aplicación que se
compone de dos páginas web distintas, las cuales usan sendos scripts, podemos
hacer:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">entry</span><span class="o">:</span> <span class="p">{</span>
   <span class="s2">&quot;site&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;./src/js/page1.js&quot;</span><span class="p">,</span> <span class="s2">&quot;./src/js/page2.js&quot;</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>lo cual tendrá el efecto de embutir ambos <em>scripts</em><a class="footnote-reference" href="#id18" id="id5">[5]</a> en un único fichero
resultante. Esto es necesario porque al ser dos <em>scripts</em> independientes
utilizar el primero u el segundo como punto de entrada no incluiría al otro en
la salida. Otra variante es:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">entry</span><span class="o">:</span> <span class="p">{</span>
   <span class="s2">&quot;page1&quot;</span><span class="o">:</span> <span class="s2">&quot;./src/js.page1.js&quot;</span><span class="p">,</span>
   <span class="s2">&quot;page2&quot;</span><span class="o">:</span> <span class="s2">&quot;./src/js.page2.js&quot;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>que mantendrá ambos <em>scripts</em> separados creando dos ficheros de salida.</p>
</div>
<div class="section" id="babel">
<span id="id6"></span><h3>4.2.3. Babel<a class="headerlink" href="#babel" title="Enlazar permanentemente con este título">¶</a></h3>
<p><strong class="program">Babel</strong> es un componente fundamental de nuestro propósito puesto que
permite sustituir sintaxis demasiado nueva por otra compatible con versiones más
antiguas de <em>Javascript</em>. Para usarlo y que transpile<a class="footnote-reference" href="#id19" id="id7">[6]</a> de forma que quede una
sintaxis ampliamente soportada, podemos añadir algunas líneas a
<code class="file docutils literal notranslate"><span class="pre">webpack/webpack.production.js</span></code>:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">merge</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;webpack-merge&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">common</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./webpack.common.js&#39;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">config</span> <span class="o">=</span> <span class="nx">merge</span><span class="p">(</span><span class="nx">common</span><span class="p">,</span> <span class="p">{</span>
   <span class="nx">mode</span><span class="o">:</span> <span class="s2">&quot;production&quot;</span><span class="p">,</span>
   <span class="nx">module</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">rules</span><span class="o">:</span> <span class="p">[</span>
         <span class="p">{</span>
            <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.js$/</span><span class="p">,</span>
            <span class="nx">exclude</span><span class="o">:</span> <span class="sr">/node_modules/</span><span class="p">,</span>
            <span class="nx">use</span><span class="o">:</span> <span class="p">{</span>
               <span class="nx">loader</span><span class="o">:</span> <span class="s2">&quot;babel-loader&quot;</span><span class="p">,</span>
               <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
                  <span class="c1">// presets: [ &quot;@babel/env&quot; ]  // Sin opciones.</span>
                  <span class="nx">presets</span><span class="o">:</span> <span class="p">[</span>
                     <span class="p">[</span><span class="s2">&quot;@babel/env&quot;</span><span class="p">,</span> <span class="p">{</span>
                        <span class="nx">debug</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
                     <span class="p">}]</span>
                  <span class="p">]</span>
               <span class="p">}</span>
            <span class="p">}</span>
         <span class="p">},</span>
      <span class="p">]</span>
   <span class="p">}</span>
<span class="p">});</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">config</span>
</pre></div>
</div>
<p>e instalar los paquetes pertinentes:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> npm install --save-dev babel-loader @babel/core @babel/cli @babel/preset-env
</pre></div>
</div>
<p>Este es el uso más simple, pero podemos ser bastante precisos y afinar mucho más
cuáles son los navegadores que pretendemos soportar. Para ello, debemos tener
presente que <strong class="program">babel</strong> es capaz de usar <a class="reference external" href="https://github.com/browserslist/browserslist">la librería browserslist</a>, en cuya documentación puede
leerse cómo expresar el grado de compatibilidad que se pretende conferir al
código. Hay varios modos de incluir este grado de compatibilidad, pero la
documentación recomienda el de incluirlo en <code class="file docutils literal notranslate"><span class="pre">package.json</span></code> a través de
la propiedad <em>browserslist</em>:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;browserslist&quot;</span><span class="o">:</span> <span class="p">{</span>
  <span class="s2">&quot;production&quot;</span><span class="o">:</span> <span class="p">[</span>
     <span class="s2">&quot;cover 95% in ES&quot;</span>
  <span class="p">],</span>
  <span class="s2">&quot;oneplus&quot;</span><span class="o">:</span> <span class="p">[</span>
     <span class="s2">&quot;&gt; 1% in ES&quot;</span>
  <span class="p">],</span>
  <span class="s2">&quot;ie10&quot;</span><span class="o">:</span> <span class="p">[</span>
     <span class="s2">&quot;&gt; .25% in ES&quot;</span><span class="p">,</span>
     <span class="s2">&quot;ie &gt;= 10&quot;</span>
  <span class="p">],</span>
  <span class="s2">&quot;relaxed&quot;</span><span class="o">:</span> <span class="p">[</span>
     <span class="s2">&quot;cover 80% in ES&quot;</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Para probar la lista de navegadores que soportará el código podemos usar la
orden:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ npx browserslist
</pre></div>
</div>
<p>que usa la definición dada por <em>production</em>, pero podemos aplicar cualquier otra,
dando un valor a la variable de ambiente <em>NODE_ENV</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ NODE_ENV=relaxed npx browserslist
</pre></div>
</div>
<p>Por tanto, podemos componer nuestra aplicación con:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ npm run build
$ NODE_ENV=relaxed npm run build
</pre></div>
</div>
<p class="rubric">Polyfill</p>
<p>Si se requiere dar soporte en navegadores antiguos a funciones como <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a>,
<a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign">Object.assign</a> o <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/from">Array.from</a> es precisa una configuración más que depende de
si disponemos de una versión de <strong class="program">babel</strong> anterior a la <strong>7.4</strong>.</p>
<p>Para versiones anteriores se debe:</p>
<ol class="arabic">
<li><p class="first">Instalar el paquete <em>&#64;babel/polyfill</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># npm install --save @babel/pollyfill</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">No hay errata. Se debe instalar como dependencia y no como
dependencia de desarrollo.</p>
</div>
</li>
<li><p class="first">Modificar la configuración de <strong class="program">webpack</strong> para añadir una opción a
<strong class="program">babel</strong>:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">merge</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;webpack-merge&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">common</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./webpack.common.js&#39;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">config</span> <span class="o">=</span> <span class="nx">merge</span><span class="p">(</span><span class="nx">common</span><span class="p">,</span> <span class="p">{</span>
   <span class="nx">mode</span><span class="o">:</span> <span class="s2">&quot;production&quot;</span><span class="p">,</span>
   <span class="nx">module</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">rules</span><span class="o">:</span> <span class="p">[</span>
         <span class="p">{</span>
            <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.js$/</span><span class="p">,</span>
            <span class="nx">exclude</span><span class="o">:</span> <span class="sr">/node_modules/</span><span class="p">,</span>
            <span class="nx">use</span><span class="o">:</span> <span class="p">{</span>
               <span class="nx">loader</span><span class="o">:</span> <span class="s2">&quot;babel-loader&quot;</span><span class="p">,</span>
               <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
                  <span class="nx">presets</span><span class="o">:</span> <span class="p">[</span>
                     <span class="p">[</span><span class="s2">&quot;@babel/env&quot;</span><span class="p">,</span> <span class="p">{</span>
                        <span class="nx">debug</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
<span class="hll">                        <span class="nx">useBuiltIns</span><span class="o">:</span> <span class="s2">&quot;usage&quot;</span><span class="p">,</span>
</span>                     <span class="p">}]</span>
                  <span class="p">]</span>
               <span class="p">}</span>
            <span class="p">}</span>
         <span class="p">},</span>
      <span class="p">]</span>
   <span class="p">}</span>
<span class="p">});</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">config</span>
</pre></div>
</div>
<p>Con esa opción, sólo se añadirán al código <em>Javascript</em> resultante, el
codigo necesario para implementar las funciones pertienen que hayamos
incorporado al código.</p>
</li>
</ol>
<p>A partir de la versión <em>7.4.0</em>, <a class="reference external" href="https://babeljs.io/docs/en/babel-polyfill">la documentación recomienda usar core-js</a> para lo cual:</p>
<ol class="arabic">
<li><p class="first">Instalamos el paquete correspondiente:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># npm install --save core-js@3</span>
</pre></div>
</div>
</li>
<li><p class="first">Modificamos la configuración de <strong class="program">webpack</strong> para añadir un par de
opciones a <strong class="program">babel</strong>:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">merge</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;webpack-merge&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">common</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./webpack.common.js&#39;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">config</span> <span class="o">=</span> <span class="nx">merge</span><span class="p">(</span><span class="nx">common</span><span class="p">,</span> <span class="p">{</span>
   <span class="nx">mode</span><span class="o">:</span> <span class="s2">&quot;production&quot;</span><span class="p">,</span>
   <span class="nx">module</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">rules</span><span class="o">:</span> <span class="p">[</span>
         <span class="p">{</span>
            <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.js$/</span><span class="p">,</span>
            <span class="nx">exclude</span><span class="o">:</span> <span class="sr">/node_modules/</span><span class="p">,</span>
            <span class="nx">use</span><span class="o">:</span> <span class="p">{</span>
               <span class="nx">loader</span><span class="o">:</span> <span class="s2">&quot;babel-loader&quot;</span><span class="p">,</span>
               <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
                  <span class="nx">presets</span><span class="o">:</span> <span class="p">[</span>
                     <span class="p">[</span><span class="s2">&quot;@babel/env&quot;</span><span class="p">,</span> <span class="p">{</span>
                        <span class="nx">debug</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
<span class="hll">                        <span class="nx">useBuiltIns</span><span class="o">:</span> <span class="s2">&quot;usage&quot;</span><span class="p">,</span>
</span><span class="hll">                        <span class="nx">corejs</span><span class="o">:</span> <span class="mi">3</span>
</span>                     <span class="p">}]</span>
                  <span class="p">]</span>
               <span class="p">}</span>
            <span class="p">}</span>
         <span class="p">},</span>
      <span class="p">]</span>
   <span class="p">}</span>
<span class="p">});</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">config</span>
</pre></div>
</div>
</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p>Para probar la configuración, podemos añadir alguna sentencia sencilla
al nuestro código <em>Javscript</em> que requiera <em>polyfill</em> como, por ejemplo:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">({},</span> <span class="p">{</span><span class="nx">a</span><span class="o">:</span><span class="mi">1</span><span class="p">});</span>
</pre></div>
</div>
<p class="last">Si probamos a generar le código con y sin la sentencia anterior y comparamos
cuánto pesan ambos ficheros veremos una ostensible diferencia, ya que con la
sentencia propuesta se tendrá que añadir el código necesario para implementar
la función. Como sólo se añade el código indispensable para implementar las
funciones necesarias, es buena idea configurar siempre <em>polyfill</em>.</p>
</div>
</div>
<div class="section" id="sass">
<h3>4.2.4. <abbr title="Syntactically Awesome Style Sheets">SASS</abbr><a class="headerlink" href="#sass" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Es posible también escribir el estilo con <abbr title="Syntactically Awesome Style Sheets">SASS</abbr> y pedirle a <strong class="program">webpack</strong>
que automatice la transformación a <abbr title="Cascading Style Sheets">CSS</abbr>. Para ello, sin embargo, requerimos
instalar algunos paquetes más:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ npm install --save-dev sass-loader node-sass
</pre></div>
</div>
<p>sustituir <code class="file docutils literal notranslate"><span class="pre">css/main.css</span></code> por este fichero equivalente
<code class="file docutils literal notranslate"><span class="pre">_sass/main.sass</span></code>:</p>
<div class="highlight-sass notranslate"><div class="highlight"><pre><span></span><span class="nv">$fondo</span><span class="o">:</span> <span class="ni">yellow</span>

<span class="nt">body</span>
   <span class="na">background-color</span><span class="o">:</span> <span class="nv">$fondo</span>
</pre></div>
</div>
<p>y, en sustitución del borrado, importar este fichero en <code class="file docutils literal notranslate"><span class="pre">js/index.js</span></code>:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">import</span> <span class="nx">style</span> <span class="nx">from</span> <span class="s2">&quot;../_sass/main.sass&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>Por último, habrá que cambiar la configuración de <strong class="program">webpack</strong> para que se
procesen los ficheros <abbr title="Syntactically Awesome Style Sheets">SASS</abbr>, de modo que en sustitución de las líneas:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.css$/i</span><span class="p">,</span>
   <span class="nx">use</span><span class="o">:</span> <span class="p">[</span><span class="nx">MiniCssExtractPlugin</span><span class="p">.</span><span class="nx">loader</span><span class="p">,</span> <span class="s2">&quot;css-loader&quot;</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>habrá que incluir:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.sass$/i</span><span class="p">,</span>
   <span class="nx">use</span><span class="o">:</span> <span class="p">[</span><span class="nx">MiniCssExtractPlugin</span><span class="p">.</span><span class="nx">loader</span><span class="p">,</span>
         <span class="s2">&quot;css-loader&quot;</span><span class="p">,</span>
         <span class="s2">&quot;sass-loader&quot;</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="autoprefixer">
<h3>4.2.5. Autoprefixer<a class="headerlink" href="#autoprefixer" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Este <em>plugin</em> modifica el <abbr title="Cascading Style Sheets">CSS</abbr> resultante para añadir prefijos del vendedor a
las opciones cuando es preciso. Antes, no obstante, es necesario instalar
algunos paquetes opciones:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ npm install --save-dev postcss-loader autoprefixer
</pre></div>
</div>
<p>Añadamos a <code class="file docutils literal notranslate"><span class="pre">_sass/main.sass</span></code> alguna opción propicia:</p>
<div class="highlight-sass notranslate"><div class="highlight"><pre><span></span><span class="na">:</span><span class="o">:</span><span class="n">placeholder</span>
   <span class="na">color</span><span class="o">:</span> <span class="ni">grey</span>
</pre></div>
</div>
<p>y modifiquemos la configuración de <code class="file docutils literal notranslate"><span class="pre">webpack/webpack.common.js</span></code> para
habilitar la transformación:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.sass$/i</span><span class="p">,</span>
   <span class="nx">use</span><span class="o">:</span> <span class="p">[</span><span class="nx">MiniCssExtractPlugin</span><span class="p">.</span><span class="nx">loader</span><span class="p">,</span>
         <span class="s2">&quot;css-loader&quot;</span><span class="p">,</span>
<span class="hll">         <span class="p">{</span>
</span><span class="hll">            <span class="nx">loader</span><span class="o">:</span> <span class="s2">&quot;postcss-loader&quot;</span><span class="p">,</span>
</span><span class="hll">            <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
</span><span class="hll">               <span class="nx">plugins</span><span class="o">:</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;autoprefixer&quot;</span><span class="p">)]</span>
</span><span class="hll">            <span class="p">}</span>
</span><span class="hll">         <span class="p">},</span>
</span>         <span class="s2">&quot;sass-loader&quot;</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">El <em>plugin</em> también usa <strong class="program">browserslist</strong> para determinar los
prefijos que debe añadir, así que es aplicable lo explicado para <a class="reference internal" href="#babel"><span class="std std-ref">babel</span></a>.</p>
</div>
</div>
<div class="section" id="procesamiento-de-css">
<h3>4.2.6. Procesamiento de <abbr title="Cascading Style Sheets">CSS</abbr><a class="headerlink" href="#procesamiento-de-css" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Es interesante discutir sobre la forma de procesar el código <abbr title="Cascading Style Sheets">CSS</abbr>, porque
dependiendo de nuestras intenciones puede interesarnos alterar las intrucciones
vertidas hasta el momento. Algunas puntualizaciones, son aplicables al uso de
cargadores para otros tipos de ficheros. En principio hemos postulado:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.css$/i</span><span class="p">,</span>
   <span class="nx">use</span><span class="o">:</span> <span class="p">[</span><span class="nx">MiniCssExtractPlugin</span><span class="p">.</span><span class="nx">loader</span><span class="p">,</span> <span class="s2">&quot;css-loader&quot;</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>y si el origen es un fichero <abbr title="Syntactically Awesome Style Sheets">SASS</abbr><a class="footnote-reference" href="#id20" id="id8">[7]</a>:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.(css|sass)$/i</span><span class="p">,</span>
   <span class="nx">use</span><span class="o">:</span> <span class="p">[</span><span class="nx">MiniCssExtractPlugin</span><span class="p">.</span><span class="nx">loader</span><span class="p">,</span> <span class="s2">&quot;css-loader&quot;</span><span class="p">,</span> <span class="s2">&quot;sass-loader&quot;</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>por lo que se puede adivinar que el procesamiento es de derecha a izquierda.  El
resultado del procesamiento de <strong class="program">css-loader</strong> es un módulo que debemos
seguir procesando para que nos resulte útil.
<strong class="program">MiniCssExtractPlugin.loader</strong> toma todos estos módulos y los compone en
un único fichero <abbr title="Cascading Style Sheets">CSS</abbr> que se coloca en el directorio de salida (el definido
mediante <em>output</em>). Sin embargo, hay otras soluciones:</p>
<dl class="docutils">
<dt><strong class="program">style-loader</strong></dt>
<dd><p class="first">Que es capaz de tomar los módulos e incluirlos dentro de un elemento <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/style">style</a>
em eñ <abbr title="HyperText Markup Language">HTML</abbr>:</p>
<div class="last highlight-js notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.css$/i</span><span class="p">,</span>
   <span class="nx">use</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;style-loader&quot;</span><span class="p">,</span> <span class="s2">&quot;css-loader&quot;</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</dd>
<dt><strong class="program">file-loader</strong>+<strong class="program">extract-loader</strong></dt>
<dd><p class="first"><strong class="program">extract-loader</strong> permite tomar los módulos y generar cadenas de
texto, mientras que <strong class="program">file-loader</strong> es capaz de tomar esas cadenas de
texto y generar ficheros de salida, uno por cadena (o sea, por fichero de
entrada) con lo que obtendré multiples ficheros en vez de uno solamente como
al usar <strong class="program">MiniCssExtractPlugin.loader</strong>:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.css$/i</span><span class="p">,</span>
   <span class="nx">use</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;file-loader?name=[path][name].css&quot;</span><span class="p">,</span> <span class="s2">&quot;extract-loader&quot;</span><span class="p">,</span> <span class="s2">&quot;css-loader&quot;</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="last admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Obsérvese que, aunque el resultado es obterner un fichero de
salida por cada fichero de entrada, tal como se obtendría usando
únicamente <em>file-loader</em> o el plugin <a class="reference external" href="https://github.com/webpack-contrib/copy-webpack-plugin">CopyPlugin</a> que se introducirá al
tratar los ejemplos, hay una gran diferencia en esta configuración:
<strong class="program">css-loader</strong> entiende y analiza los ficheros <abbr title="Cascading Style Sheets">CSS</abbr> y es capaz de
reconocer enlaces a otros ficheros incluidos en su contenido a través de
cláusulas <code class="code docutils literal notranslate"><span class="pre">&#64;import</span></code> o <code class="code docutils literal notranslate"><span class="pre">url()</span></code>. El efecto es que esos ficheros
referidos también pasarán a formar parte del procesamiento sin necesidad
de referirlos explícitamente como punto de entrada.</p>
</div>
</dd>
</dl>
<p>Es también interesante reseñar que <em>use</em> puede ser también una función que
devuelva el array de cargadores, lo que permite generar de forma dinámica qué
transformaciones se obrarán:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.css$/i</span><span class="p">,</span>
   <span class="nx">use</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">file</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Procesando... &quot;</span><span class="p">,</span> <span class="nx">file</span><span class="p">.</span><span class="nx">resource</span><span class="p">);</span>
      <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;style-loader&quot;</span><span class="p">,</span> <span class="s2">&quot;css-loader&quot;</span><span class="p">];</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>También es útil saber que:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.css$/i</span><span class="p">,</span>
   <span class="nx">use</span><span class="o">:</span> <span class="p">[{</span>
      <span class="nx">loader</span><span class="o">:</span> <span class="s2">&quot;file-loader&quot;</span><span class="p">,</span>
      <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
         <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;[name].[ext]&quot;</span>
      <span class="p">}</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>equivale a:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.css$/i</span><span class="p">,</span>
   <span class="nx">user</span> <span class="p">[</span><span class="s2">&quot;file-loader?name=[name].[ext]&quot;</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="imagenes">
<h3>4.2.7. Imágenes<a class="headerlink" href="#imagenes" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Imaginemos que incluimos en nuestro <abbr title="HyperText Markup Language">HTML</abbr> de ejemplo alguna imagen:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;es&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Aplicación simple<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Aplicación simple<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;images/logo512.png&quot;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&quot;Logo HTML grande&quot;</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;images/logo64.png&quot;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&quot;Logo HTML pequeño&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Para las imágenes se han tomando el logo de <abbr title="HyperText Markup Language">HTML</abbr>5, descargado de
la <a class="reference external" href="https://www.w3.org/html/logo/">página oficial</a>, en tamaño de 512px y
64px.</p>
</div>
<p>Si probáramos inmediatamente a regenerar el <em>bundle</em>, veríamos que escupe un
error como consecuencia de que no sabe manejar este tipo de ficheros. Para
hacerlo es preciso usar <strong class="program">url-loader</strong>:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="c1">// webpack/webpack.common.js</span>
<span class="kr">const</span> <span class="nx">HtmlWebPackPlugin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;html-webpack-plugin&quot;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">MiniCssExtractPlugin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;mini-css-extract-plugin&quot;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">config</span> <span class="o">=</span> <span class="p">{</span>
   <span class="nx">entry</span><span class="o">:</span> <span class="s2">&quot;./src/js/index.js&quot;</span><span class="p">,</span>
   <span class="nx">output</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">filename</span><span class="o">:</span> <span class="s2">&quot;js/[name].bundle.js&quot;</span>
   <span class="p">},</span>
   <span class="nx">module</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">rules</span><span class="o">:</span> <span class="p">[</span>
         <span class="p">{</span>
            <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.html$/</span><span class="p">,</span>
            <span class="nx">use</span><span class="o">:</span> <span class="p">{</span>
               <span class="nx">loader</span><span class="o">:</span> <span class="s2">&quot;html-loader&quot;</span><span class="p">,</span>
               <span class="nx">options</span><span class="o">:</span> <span class="p">{</span> <span class="nx">minimize</span><span class="o">:</span> <span class="kc">true</span> <span class="p">}</span>
            <span class="p">}</span>
         <span class="p">},</span>
         <span class="p">{</span>
            <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.css$/</span><span class="p">,</span>
            <span class="nx">use</span><span class="o">:</span> <span class="p">[</span><span class="nx">MiniCssExtractPlugin</span><span class="p">.</span><span class="nx">loader</span><span class="p">,</span>
                  <span class="s2">&quot;css-loader&quot;</span><span class="p">]</span>
         <span class="p">},</span>
         <span class="p">{</span>
            <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.(png|jpe?g|gif|svg)$/i</span><span class="p">,</span>
            <span class="nx">use</span><span class="o">:</span> <span class="p">[</span>
               <span class="c1">// &#39;url-loader?limit=4096&amp;name=images/[name].[ext]&#39;,</span>
               <span class="p">{</span>
                  <span class="nx">loader</span><span class="o">:</span> <span class="s1">&#39;url-loader&#39;</span><span class="p">,</span>
                  <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
                     <span class="nx">limit</span><span class="o">:</span> <span class="mi">4096</span><span class="p">,</span>
                     <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;images/[name].[ext]&#39;</span>
                  <span class="p">}</span>
               <span class="p">}</span>
            <span class="p">]</span>
         <span class="p">}</span>
      <span class="p">]</span>
   <span class="p">},</span>
   <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
      <span class="k">new</span> <span class="nx">HtmlWebPackPlugin</span><span class="p">({</span>
         <span class="nx">template</span><span class="o">:</span> <span class="s2">&quot;src/index.html&quot;</span><span class="p">,</span>
         <span class="c1">//filename: &quot;index.html&quot;   // Es el valor predeterminado</span>
      <span class="p">}),</span>
      <span class="k">new</span> <span class="nx">MiniCssExtractPlugin</span><span class="p">({</span>
         <span class="nx">filename</span><span class="o">:</span> <span class="s2">&quot;css/[name].css&quot;</span><span class="p">,</span>
         <span class="nx">chunkFilename</span><span class="o">:</span> <span class="s2">&quot;[id].css&quot;</span>
      <span class="p">})</span>
   <span class="p">]</span>
<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">config</span>
</pre></div>
</div>
<p>Este cargador hace dos cosas:</p>
<ul class="simple">
<li>Copia el fichero (no tiene por qué ser una imagen) al resultado final.</li>
<li>Pero si el fichero es menor que el límite definido (en el ejemplo 4K), en vez
de copiar el fichero genera una <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/Data_URIs">dataURI</a> en Base64.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p>Para imágenes exclusivamente puede usarse <strong class="program">img-loader</strong> que es
un minimizador de imágenes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># npm install --save-dev img-loader</span>
</pre></div>
</div>
<p>y la configuración podría hacerse así:</p>
<div class="last highlight-js notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.(png|jpe?g|gif|svg)$/i</span><span class="p">,</span>
   <span class="nx">use</span><span class="o">:</span> <span class="p">[</span>
      <span class="s1">&#39;url-loader?limit=4096&amp;name=images/[name].[ext]&#39;</span><span class="p">,</span>
      <span class="s1">&#39;img-loader&#39;</span>
   <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="multiples-entornos">
<h3>4.2.8. Múltiples entornos<a class="headerlink" href="#multiples-entornos" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Con la configuración hecha hasta aquí, tenemos dos configuraciones distintas:
una para producción y otra para desarrollo que se logran cargando ficheros
de configuración distintos. Sin embargo, <strong class="program">webpack</strong> permite pasar por
línea de comandos variables que pueden utilizarse dentro del <em>script</em> que
constituye la configuración<a class="footnote-reference" href="#id21" id="id9">[8]</a>. Jugar con los valores de estas variables posibilita
crear una amplia variedad de configuraciones de manera sencilla.</p>
<p>Para ilustrarlo crearemos una configuración con los siguientes ficheros:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>+-- webpack.config.js
+-- webpack/
      +-- webpack.common.js
      +-- webpack.production.js
      +-- webpack.development.js
</pre></div>
</div>
<p>que invocaremos del siguiente modo:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;scripts&quot;</span><span class="o">:</span> <span class="p">{</span>
   <span class="s2">&quot;build&quot;</span><span class="o">:</span> <span class="s2">&quot;webpack --env.production&quot;</span><span class="p">,</span>
   <span class="s2">&quot;watch&quot;</span><span class="o">:</span> <span class="s2">&quot;webpack --env --watch&quot;</span><span class="p">,</span>
   <span class="s2">&quot;debug&quot;</span><span class="o">:</span> <span class="s2">&quot;webpack-dev-server --env --open chromium&quot;</span>
<span class="p">},</span>
</pre></div>
</div>
<p>En el caso de <code class="code docutils literal notranslate"><span class="pre">build</span></code> se pasa la variable <em>production</em> con un valor
verdadero, ya que no indicar su valor indica tal cosa
(<code class="code docutils literal notranslate"><span class="pre">--env.foobar=valor</span></code> permitiría pasar para una variable un valor
concreto). En los otros dos casos debe usarse <code class="code docutils literal notranslate"><span class="pre">--env</span></code> para que se creen el
objeto <em>env</em>, pero al no pasarlo <em>production</em> queda indefinido y, por tanto,
puede asimilarse a <code class="code docutils literal notranslate"><span class="pre">false</span></code>.</p>
<p>Los ficheros de configuración quedan así:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="c1">// webpack/webpack.common.js</span>
<span class="kr">const</span> <span class="nx">HtmlWebPackPlugin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;html-webpack-plugin&quot;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">MiniCssExtractPlugin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;mini-css-extract-plugin&quot;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">config</span> <span class="o">=</span> <span class="p">{</span>
   <span class="nx">entry</span><span class="o">:</span> <span class="s2">&quot;./src/js/index.js&quot;</span><span class="p">,</span>
   <span class="nx">output</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">filename</span><span class="o">:</span> <span class="s2">&quot;js/[name].bundle.js&quot;</span>
   <span class="p">},</span>
   <span class="nx">module</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">rules</span><span class="o">:</span> <span class="p">[</span>
         <span class="p">{</span>
            <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.html$/</span><span class="p">,</span>
            <span class="nx">use</span><span class="o">:</span> <span class="p">{</span>
               <span class="nx">loader</span><span class="o">:</span> <span class="s2">&quot;html-loader&quot;</span><span class="p">,</span>
               <span class="nx">options</span><span class="o">:</span> <span class="p">{</span> <span class="nx">minimize</span><span class="o">:</span> <span class="kc">true</span> <span class="p">}</span>
            <span class="p">}</span>
         <span class="p">},</span>
         <span class="p">{</span>
            <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.(css|sass)$/</span><span class="p">,</span>
            <span class="nx">use</span><span class="o">:</span> <span class="p">[</span><span class="nx">MiniCssExtractPlugin</span><span class="p">.</span><span class="nx">loader</span><span class="p">,</span>
                  <span class="s2">&quot;css-loader&quot;</span><span class="p">,</span>
                  <span class="p">{</span> 
                     <span class="nx">loader</span><span class="o">:</span> <span class="s2">&quot;postcss-loader&quot;</span><span class="p">,</span>
                     <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
                        <span class="nx">plugins</span><span class="o">:</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;autoprefixer&quot;</span><span class="p">)]</span>
                     <span class="p">}</span>
                  <span class="p">},</span>
                  <span class="s2">&quot;sass-loader&quot;</span><span class="p">]</span>
         <span class="p">},</span>
         <span class="p">{</span>
            <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.(png|jpe?g|gif|svg)$/i</span><span class="p">,</span>
            <span class="nx">use</span><span class="o">:</span> <span class="p">[</span>
               <span class="s1">&#39;url-loader?limit=4096&amp;name=images/[name].[ext]&#39;</span><span class="p">,</span>
               <span class="s1">&#39;img-loader&#39;</span>
            <span class="p">]</span>
         <span class="p">}</span>
      <span class="p">]</span>
   <span class="p">},</span>
   <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
      <span class="k">new</span> <span class="nx">HtmlWebPackPlugin</span><span class="p">({</span>
         <span class="nx">template</span><span class="o">:</span> <span class="s2">&quot;src/index.html&quot;</span><span class="p">,</span>
         <span class="c1">//filename: &quot;index.html&quot;   // Es el valor predeterminado</span>
      <span class="p">}),</span>
      <span class="k">new</span> <span class="nx">MiniCssExtractPlugin</span><span class="p">({</span>
         <span class="nx">filename</span><span class="o">:</span> <span class="s2">&quot;css/[name].css&quot;</span><span class="p">,</span>
         <span class="nx">chunkFilename</span><span class="o">:</span> <span class="s2">&quot;[id].css&quot;</span>
      <span class="p">})</span>
   <span class="p">]</span>
<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">config</span>
</pre></div>
</div>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="c1">// webpack/webpack.productiom.js</span>
<span class="kr">const</span> <span class="nx">merge</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;webpack-merge&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">common</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./webpack.common.js&#39;</span><span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">env</span> <span class="p">=&gt;</span> <span class="p">{</span>
   <span class="k">return</span> <span class="nx">merge</span><span class="p">(</span><span class="nx">common</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">mode</span><span class="o">:</span> <span class="s2">&quot;production&quot;</span><span class="p">,</span>
      <span class="nx">module</span><span class="o">:</span> <span class="p">{</span>
         <span class="nx">rules</span><span class="o">:</span> <span class="p">[</span>
            <span class="p">{</span>
               <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.js$/</span><span class="p">,</span>
               <span class="nx">exclude</span><span class="o">:</span> <span class="sr">/node_modules/</span><span class="p">,</span>
               <span class="nx">use</span><span class="o">:</span> <span class="p">{</span>
                  <span class="nx">loader</span><span class="o">:</span> <span class="s2">&quot;babel-loader&quot;</span><span class="p">,</span>
                  <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
                     <span class="nx">presets</span><span class="o">:</span> <span class="p">[[</span><span class="s2">&quot;@babel/env&quot;</span><span class="p">,</span> <span class="p">{</span>
<span class="hll">                        <span class="nx">debug</span><span class="o">:</span> <span class="nx">env</span><span class="p">.</span><span class="nx">debug</span><span class="p">,</span>
</span>                        <span class="nx">corejs</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span>
                        <span class="nx">useBuiltIns</span><span class="o">:</span> <span class="s2">&quot;usage&quot;</span>
                     <span class="p">}]]</span>
                  <span class="p">}</span>
               <span class="p">}</span>
            <span class="p">},</span>
         <span class="p">]</span>
      <span class="p">}</span>
   <span class="p">});</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="c1">// webpack/webpack.development.js</span>
<span class="kr">const</span> <span class="nx">merge</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;webpack-merge&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">common</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./webpack.common.js&#39;</span><span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">env</span> <span class="p">=&gt;</span> <span class="p">{</span>
   <span class="k">return</span> <span class="nx">merge</span><span class="p">(</span><span class="nx">common</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">mode</span><span class="o">:</span> <span class="s2">&quot;development&quot;</span><span class="p">,</span>
      <span class="nx">devtool</span><span class="o">:</span> <span class="s1">&#39;inline-source-map&#39;</span><span class="p">,</span>
   <span class="p">});</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">env</span> <span class="p">=&gt;</span> <span class="p">{</span>
<span class="hll">   <span class="kd">let</span> <span class="nx">mode</span><span class="p">;</span>
</span>
   <span class="k">switch</span><span class="p">(</span><span class="nx">env</span><span class="p">.</span><span class="nx">output</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">case</span> <span class="s2">&quot;debug&quot;</span><span class="o">:</span>
      <span class="k">case</span> <span class="s2">&quot;src&quot;</span><span class="o">:</span>
         <span class="nx">mode</span> <span class="o">=</span> <span class="s2">&quot;development&quot;</span><span class="p">;</span>
         <span class="k">break</span><span class="p">;</span>
      <span class="k">default</span><span class="o">:</span>
         <span class="nx">mode</span> <span class="o">=</span> <span class="s2">&quot;production&quot;</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="k">return</span> <span class="nx">require</span><span class="p">(</span><span class="sb">`./webpack/webpack.</span><span class="si">${</span><span class="nx">mode</span><span class="si">}</span><span class="sb">.js`</span><span class="p">)(</span><span class="nx">env</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Para precisar la configuración se usan dos variables:</p>
<ul class="simple">
<li><em>production</em>, ya introducida anteriormente.</li>
<li><em>debug</em>, que permite definir si se quieren mensajes de depuración
de <a class="reference internal" href="#babel"><span class="std std-ref">babel</span></a>.</li>
</ul>
</div>
<div class="section" id="carga-de-modulos">
<h3>4.2.9. Carga de módulos<a class="headerlink" href="#carga-de-modulos" title="Enlazar permanentemente con este título">¶</a></h3>
<div class="section" id="sistema-de-modulos">
<h4>4.2.9.1. Sistema de módulos<a class="headerlink" href="#sistema-de-modulos" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Como se verá en los <a class="reference internal" href="#webpack-ejemplos"><span class="std std-ref">ejemplos posteriores</span></a>, lo habitual
es que el código se deba cargar otros módulos propios o ajenos. <strong class="program">webpack</strong>
permite que se usa tanto el sistema <a class="reference external" href="https://nodejs.org/docs/latest/api/modules.html">CommonJS</a> como el <em>ES2015</em>. Aconsejamos:</p>
<ul class="simple">
<li>Usar <a class="reference external" href="https://nodejs.org/docs/latest/api/modules.html">CommonJS</a> en los ficheros de configuración, ya que es el sistema para el
que <em>NodeJS</em> tiene soporte.</li>
<li>Usar <em>ES2015</em> dentro del código de la propia aplicación, ya que es el estándar
aprobado y bajo determinadas circunstancias (como no importar aplicaciones de
terceros<a class="footnote-reference" href="#id22" id="id10">[9]</a> dentro del propio código), genera un código directamente usable
en navegadores modernos.</li>
</ul>
</div>
<div class="section" id="importacion-en-la-configuracion">
<span id="webpack-conf-import"></span><h4>4.2.9.2. Importación en la configuración<a class="headerlink" href="#importacion-en-la-configuracion" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Ya se ha visto que para cargar módulos (al estilo <em>ES2015</em>, por ejemplo) es
necesario:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>import L from &quot;leaflet&quot;;
import $ from &quot;jquery&quot;;
</pre></div>
</div>
<p>Ahora bien, con <strong class="program">webpack</strong> es también posible hacer esta importación
a través de la configuración, haciendo uso del plugin <a class="reference external" href="https://webpack.js.org/plugins/provide-plugin/">Provide</a>:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="c1">// webpack.config.js</span>
<span class="kr">const</span> <span class="nx">webpack</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;webpack&quot;</span><span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
   <span class="c1">// ...</span>
   <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
      <span class="k">new</span> <span class="nx">webpack</span><span class="p">.</span><span class="nx">ProvidePlugin</span><span class="p">({</span>
         <span class="nx">L</span><span class="o">:</span> <span class="s2">&quot;leaflet&quot;</span><span class="p">,</span>
         <span class="nx">$</span><span class="o">:</span> <span class="s2">&quot;jquery&quot;</span>
      <span class="p">})</span>
   <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Esta alternativa es provechosa para dos situaciones:</p>
<ul>
<li><p class="first">Cuando se usan librerías de terceros, ya que <strong class="program">webpack</strong> será capaz de
construir los ficheros resultantes (contengan o no estas librerías de terceros),
pero su importación no se encuentra en el código, por lo que si hemos usando
el estilo <em>ES2015</em> y el navegador es moderno y lo soporta, podremos usar
directamente el código fuente a través de la etiqueta <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/script">script</a>, añadiendo las
librerías de terceros a través de otras etiquetas <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/script">script</a>.</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://unpkg.com/leaflet@1.5.1/dist/leaflet.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://unpkg.com/jquery@3.3.1/dist/jquery.min.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;module&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;src/js/index.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div>
</div>
</li>
<li><p class="first">Cuando requirimos importar repetidamente las librerías en distintos ficheros
de nuestra aplicación.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="section" id="ejemplos">
<span id="webpack-ejemplos"></span><h2>4.3. Ejemplos<a class="headerlink" href="#ejemplos" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Los ejemplos de aplicación los construiremos en torno a  <a class="reference external" href="https://leafletjs.com">Leaflet</a>, la excelente
librería <abbr title="Geographic information system">GIS</abbr> y trataremos tres casos:</p>
<ol class="arabic simple">
<li>La creación de un plugin para esta librería, lo cual supone no crear una
aplicación web en sí, sino tan sólo código <em>Javascript</em> intermedio que puede
usarse posteriormente en la creación de una aplicación web.</li>
<li>La creación del plugin comentado, pero con la adición de algún ejemplo de uso
que permita, no sólamente ilustrar cómo se utiliza, si no también, comprobar
el código del plugin mientras se desarrolla. Es en realidad este caso, el que
se debe llevar a la práctica, porque es evidente que cualquier desarrollo
exige un proceso continuo de comprobación del código.</li>
<li>La creación de una aplicación web que use el plugin anterior, lo cual
significa que el resultado final será una página <abbr title="HyperText Markup Language">HTML</abbr> (con todos sus
avíos).</li>
</ol>
<div class="section" id="plugin">
<span id="webpack-ej-plugin"></span><h3>4.3.1. Plugin<a class="headerlink" href="#plugin" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Trataremos de hacer un plugin que implemente el efecto de agrandar un icono al
pasar el punto del ratón sobre él. Tal plugin es bastante sencillo y no requiere
más que escribir unas pocas líneas en un único fichero <code class="docutils literal notranslate"><span class="pre">.js</span></code>. A pesar de esta
simpleza, hay particularidad: como nuestro código utiliza una librería de
terceros (<a class="reference external" href="https://leafletjs.com">Leaflet</a>), el código resultante puede o no contenerla:</p>
<ul class="simple">
<li>Si la contiene, puede servirnos para utilizarlo directamente en una aplicación
web sin necesidad de cargar también <a class="reference external" href="https://leafletjs.com">Leaflet</a>.</li>
<li>Si no la contiene, puede servirnos tanto como librería para hacer desarrollos
posteriores con <em>NodeJS</em> (por supuesto, instalando también <a class="reference external" href="https://leafletjs.com">Leaflet</a>), como para
utlizarla directamente en una aplicación web cargando <a class="reference external" href="https://leafletjs.com">Leaflet</a> con otra
etiqueta <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/script">script</a>.</li>
</ul>
<ol class="arabic">
<li><p class="first">Preparemos el directorio de trabajo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> mkdir leaflet.iconzoom
<span class="gp">$</span> <span class="nb">cd</span> leaflet.iconzoom
<span class="gp">$</span> npm init -y
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Se supone que estamos usando la configuración
<a class="reference download internal" download="" href="../_downloads/ba8647bdabac7a535df86b567755f620/npm-init.js"><code class="xref download docutils literal notranslate"><span class="pre">~/.npm-init.js</span></code></a> propuesta al
explicar <a class="reference internal" href="../03.node/01.nodejs.html#prep-workdir"><span class="std std-ref">cómo crear un  directorio de trabajo para NodeJS</span></a>.</p>
</div>
<p>A la pregunta de cuál será el fichero principal contestaremos que
<code class="file docutils literal notranslate"><span class="pre">dist/leaflet.iconzoom.js</span></code>. Esta pregunta no es baladí, ya que este
será el fichero que se importará cuando un aplicación ulterior use este
plugin, importándolo con la línea:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">import</span> <span class="s2">&quot;leaflet.iconzoom&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>La razón de que este sea el fichero apropiado es que es perfectamente
funcional, portable y está optimizado.</p>
</li>
<li><p class="first">Editamos <code class="file docutils literal notranslate"><span class="pre">package.json</span></code> para dejar los <em>scripts</em> del siguiente modo:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;scripts&quot;</span><span class="o">:</span> <span class="p">{</span>
   <span class="s2">&quot;build&quot;</span><span class="o">:</span> <span class="s2">&quot;webpack --env.output=min&quot;</span><span class="p">,</span>
   <span class="s2">&quot;bundle&quot;</span><span class="o">:</span> <span class="s2">&quot;webpack --env.output=bundle&quot;</span><span class="p">,</span>
   <span class="s2">&quot;src&quot;</span><span class="o">:</span> <span class="s2">&quot;webpack --env.output=src&quot;</span><span class="p">,</span>
   <span class="s2">&quot;debug&quot;</span><span class="o">:</span> <span class="s2">&quot;webpack-dev-server --env.output=debug --open&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<dl class="docutils">
<dt><em>build</em></dt>
<dd><p class="first">Código para producción <strong>sin</strong> <a class="reference external" href="https://leafletjs.com">Leaflet</a>:</p>
<div class="last highlight-html notranslate"><div class="highlight"><pre><span></span><span class="c">&lt;!-- Leaflet --&gt;</span>
<span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;https://unpkg.com/leaflet@1.5.1/dist/leaflet.css&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://unpkg.com/leaflet@1.5.1/dist/leaflet.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

<span class="c">&lt;!-- Plugin --&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;../dist/leaflet.iconzoom.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div>
</div>
</dd>
<dt><em>bundle</em></dt>
<dd><p class="first">Código para producción que incluye <a class="reference external" href="https://leafletjs.com">Leaflet</a>.</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="c">&lt;!-- Leaflet+Plugin --&gt;</span>
<span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;../dist/leaflet.iconzoom.bundle.css&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;../dist/leaflet.iconzoom.bundle.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div>
</div>
<div class="last admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">En este caso, el <em>plugin</em> es muy sencillo y no requiere <abbr title="Cascading Style Sheets">CSS</abbr>
adicional, por lo que el <abbr title="Cascading Style Sheets">CSS</abbr> generado será una copia, sin más, del de
<a class="reference external" href="https://leafletjs.com">Leaflet</a>.</p>
</div>
</dd>
<dt><em>src</em></dt>
<dd><p class="first">Código para depuración <strong>sin</strong> <a class="reference external" href="https://leafletjs.com">Leaflet</a> para su carga desde un navegador:
.. code-block:: html</p>
<blockquote>
<div><p>&lt;!– Leaflet –&gt;
&lt;link rel=»stylesheet» href=»<a class="reference external" href="https://unpkg.com/leaflet&#64;1.5.1/dist/leaflet.css">https://unpkg.com/leaflet&#64;1.5.1/dist/leaflet.css</a>»&gt;
&lt;script src=»<a class="reference external" href="https://unpkg.com/leaflet&#64;1.5.1/dist/leaflet.js">https://unpkg.com/leaflet&#64;1.5.1/dist/leaflet.js</a>»&gt;&lt;/script&gt;</p>
<p>&lt;!– Plugin para depuración –&gt;
&lt;script src=»../dist/leaflet.iconzoom-src.js»&gt;&lt;/script&gt;</p>
</div></blockquote>
<p>En principio, es útil para que terceros puedan inspeccionar el código y
cazar <em>bugs</em> sin necesidad de usar de instalar <a class="reference external" href="https://nodejs.org/">NodeJS</a> y preparar un
directorio de trabajo con el código fuente.</p>
<div class="last admonition note">
<p class="first admonition-title">Nota</p>
<p>Si el navegador fuera moderno, podríamos utilizar directamente
el código fuente, en vez de este fichero:</p>
<div class="last highlight-html notranslate"><div class="highlight"><pre><span></span><span class="c">&lt;!-- Leaflet --&gt;</span>
<span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;https://unpkg.com/leaflet@1.5.1/dist/leaflet.css&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://unpkg.com/leaflet@1.5.1/dist/leaflet.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

<span class="c">&lt;!-- Plugin para depuración --&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;module&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;../src/index.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div>
</div>
</div>
</dd>
<dt><em>debug</em></dt>
<dd><p class="first last">Script para depuración interactiva. Como esto requiere crear un ejemplo de
uso y una configuración más compleja de <strong class="program">webpack</strong>, no será operativo
hasta que desarrollemos el próximo caso.</p>
</dd>
</dl>
</li>
<li><p class="first">Instalamos los paquetes necesarios<a class="footnote-reference" href="#id23" id="id11">[10]</a>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> npm install --save-dev webpack webpack-dev-server webpack-cli webpack-merge
<span class="gp">$</span> npm install --save-dev babel-loader @babel/core @babel/cli @babel/preset-env
<span class="gp">$</span> npm install core-js leaflet
<span class="gp">$</span> npm install --save-dev css-loader mini-css-extract-plugin
<span class="gp">$</span> npm install --save-dev url-loader file-loader
</pre></div>
</div>
</li>
<li><p class="first">Escribimos el plugin en <a class="reference download internal" download="" href="../_downloads/d6c10a921f4d02ce004907a13fde1de5/leaflet.iconzoom.js"><code class="xref download docutils literal notranslate"><span class="pre">src/leaflet.iconzoom.js</span></code></a>:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">L</span><span class="p">.</span><span class="nx">Icon</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">zoom</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">factor</span><span class="p">)</span> <span class="p">{</span>
   <span class="nx">factor</span> <span class="o">=</span> <span class="nx">factor</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">factor</span><span class="p">;</span>
   <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">factor</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
   <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">iconSize</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">iconSize</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">e</span> <span class="p">=&gt;</span> <span class="nx">e</span><span class="o">*</span><span class="nx">factor</span><span class="p">);</span>
   <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">iconAnchor</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">iconAnchor</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">e</span> <span class="p">=&gt;</span> <span class="nx">e</span><span class="o">*</span><span class="nx">factor</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">L</span><span class="p">.</span><span class="nx">Marker</span><span class="p">.</span><span class="nx">addInitHook</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
   <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;mouseover mouseout&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span> 
      <span class="kr">const</span> <span class="nx">icon</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">icon</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">icon</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">factor</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s2">&quot;mouseover&quot;</span><span class="p">)</span> <span class="nx">icon</span><span class="p">.</span><span class="nx">zoom</span><span class="p">();</span>
      <span class="k">else</span> <span class="p">{</span>
         <span class="k">delete</span> <span class="nx">icon</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">iconSize</span><span class="p">;</span>
         <span class="k">delete</span> <span class="nx">icon</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">iconAnchor</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">setIcon</span><span class="p">(</span><span class="nx">icon</span><span class="p">);</span>
   <span class="p">});</span>
<span class="p">});</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p>Del código pueden resultar chocantes varios aspectos:</p>
<ul class="last simple">
<li>El módulo se limita a alterar el objeto global <code class="code docutils literal notranslate"><span class="pre">L</span></code> por lo
que no es preciso exportar nada. De haber exportado algo, se habría
usado el sistema de módulos de <em>ES2015</em>.</li>
<li>No se importa dentro del código nada procedente de <a class="reference external" href="https://leafletjs.com">Leaflet</a>, porque:<ul>
<li>El código <em>Javascript</em> se importará a través del <a class="reference internal" href="#webpack-conf-import"><span class="std std-ref">plugin Provide</span></a> por ser la librería de terceros.</li>
<li>El código <abbr title="Cascading Style Sheets">CSS</abbr> se incluirá en el punto de entrada, para
lograr que se lleve a cabo el procesamiento sólo si obtiene la
variante <em>bundle</em> del p*lugin*.</li>
</ul>
</li>
</ul>
</div>
</li>
<li><p class="first">Y el verdadero meollo, configuramos <strong class="program">webpack</strong> de forma modular. Por
un lado, <a class="reference download internal" download="" href="../_downloads/c680c5a71fff2d42abbea0eec899bf5a/webpack.config.f.js"><code class="xref download docutils literal notranslate"><span class="pre">webpack.config.js</span></code></a>:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">env</span> <span class="p">=&gt;</span> <span class="p">{</span>
   <span class="kd">let</span> <span class="nx">mode</span><span class="p">;</span>

   <span class="k">switch</span><span class="p">(</span><span class="nx">env</span><span class="p">.</span><span class="nx">output</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">case</span> <span class="s2">&quot;debug&quot;</span><span class="o">:</span>
      <span class="k">case</span> <span class="s2">&quot;src&quot;</span><span class="o">:</span>
         <span class="nx">mode</span> <span class="o">=</span> <span class="s2">&quot;development&quot;</span><span class="p">;</span>
         <span class="k">break</span><span class="p">;</span>
      <span class="k">default</span><span class="o">:</span>
         <span class="nx">mode</span> <span class="o">=</span> <span class="s2">&quot;production&quot;</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="k">return</span> <span class="nx">require</span><span class="p">(</span><span class="sb">`./webpack/webpack.</span><span class="si">${</span><span class="nx">mode</span><span class="si">}</span><span class="sb">.js`</span><span class="p">)(</span><span class="nx">env</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>En la parte común de la configuración, <a class="reference download internal" download="" href="../_downloads/9fb7f61eeba5b393165bcfde725297e1/webpack.common.js"><code class="xref download docutils literal notranslate"><span class="pre">webpack/webpack.common.js</span></code></a>, que es esta:</p>
<div class="highlight-js notranslate" id="webpack-plugin-webpack-common-js"><div class="highlight"><pre><span></span><span class="c1">// webpack/webpack.common.js</span>
<span class="kr">const</span> <span class="nx">webpack</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;webpack&quot;</span><span class="p">),</span>
      <span class="nx">merge</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;webpack-merge&quot;</span><span class="p">),</span>
      <span class="nx">MiniCssExtractPlugin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;mini-css-extract-plugin&quot;</span><span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">env</span> <span class="p">=&gt;</span> <span class="p">{</span>
   <span class="kd">let</span> <span class="nx">filename</span><span class="p">;</span>

<span class="hll">   <span class="k">switch</span><span class="p">(</span><span class="nx">env</span><span class="p">.</span><span class="nx">output</span><span class="p">)</span> <span class="p">{</span>
</span><span class="hll">      <span class="k">case</span> <span class="s2">&quot;min&quot;</span><span class="o">:</span>
</span><span class="hll">      <span class="k">case</span> <span class="s2">&quot;debug&quot;</span><span class="o">:</span>
</span><span class="hll">         <span class="nx">filename</span> <span class="o">=</span> <span class="s2">&quot;[name].js&quot;</span><span class="p">;</span>
</span><span class="hll">         <span class="k">break</span><span class="p">;</span>
</span><span class="hll">      <span class="k">case</span> <span class="s2">&quot;src&quot;</span><span class="o">:</span>
</span><span class="hll">         <span class="nx">filename</span> <span class="o">=</span> <span class="s2">&quot;[name]-src.js&quot;</span><span class="p">;</span>
</span><span class="hll">         <span class="k">break</span>
</span><span class="hll">      <span class="k">default</span><span class="o">:</span>
</span><span class="hll">         <span class="nx">filename</span> <span class="o">=</span> <span class="sb">`[name].</span><span class="si">${</span><span class="nx">env</span><span class="p">.</span><span class="nx">output</span><span class="si">}</span><span class="sb">.js`</span><span class="p">;</span>
</span><span class="hll">   <span class="p">}</span>
</span>
   <span class="kr">const</span> <span class="nx">config</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">entry</span><span class="o">:</span> <span class="p">{</span>
         <span class="s2">&quot;leaflet.iconzoom&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;./src/index.js&quot;</span><span class="p">]</span>
      <span class="p">},</span>
      <span class="nx">output</span><span class="o">:</span> <span class="p">{</span>
         <span class="nx">filename</span><span class="o">:</span> <span class="nx">filename</span>
      <span class="p">},</span>
      <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
<span class="hll">         <span class="k">new</span> <span class="nx">webpack</span><span class="p">.</span><span class="nx">ProvidePlugin</span><span class="p">({</span>
</span><span class="hll">            <span class="nx">L</span><span class="o">:</span> <span class="s2">&quot;leaflet&quot;</span>
</span><span class="hll">         <span class="p">})</span>
</span>      <span class="p">]</span>
   <span class="p">}</span>

   <span class="k">if</span><span class="p">(</span><span class="nx">env</span><span class="p">.</span><span class="nx">output</span> <span class="o">===</span> <span class="s2">&quot;bundle&quot;</span><span class="p">)</span> <span class="p">{</span>
<span class="hll">      <span class="nx">config</span><span class="p">.</span><span class="nx">entry</span><span class="p">[</span><span class="s2">&quot;leaflet.iconzoom&quot;</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;leaflet/dist/leaflet.css&quot;</span><span class="p">);</span>
</span>      <span class="k">return</span> <span class="nx">merge</span><span class="p">(</span><span class="nx">config</span><span class="p">,</span> <span class="p">{</span>
         <span class="nx">module</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">rules</span><span class="o">:</span> <span class="p">[</span>
               <span class="p">{</span>
                  <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.css$/</span><span class="p">,</span>
                  <span class="nx">use</span><span class="o">:</span> <span class="p">[</span><span class="nx">MiniCssExtractPlugin</span><span class="p">.</span><span class="nx">loader</span><span class="p">,</span>
                        <span class="s2">&quot;css-loader&quot;</span><span class="p">]</span>
               <span class="p">},</span>
               <span class="p">{</span>
                  <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.(png|jpe?g|gif|svg)$/i</span><span class="p">,</span>
                  <span class="nx">use</span><span class="o">:</span> <span class="p">[</span>
                     <span class="s1">&#39;url-loader?limit=4096&amp;name=images/[name].[ext]&#39;</span>
                  <span class="p">]</span>
               <span class="p">}</span>
            <span class="p">]</span>
         <span class="p">},</span>
         <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
            <span class="k">new</span> <span class="nx">MiniCssExtractPlugin</span><span class="p">({</span>
               <span class="nx">filename</span><span class="o">:</span> <span class="s2">&quot;[name].bundle.css&quot;</span><span class="p">,</span>
               <span class="nx">chunkFilename</span><span class="o">:</span> <span class="s2">&quot;[id].css&quot;</span>
            <span class="p">})</span>
         <span class="p">]</span>
      <span class="p">});</span>
   <span class="p">}</span>
   <span class="k">else</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">merge</span><span class="p">(</span><span class="nx">config</span><span class="p">,</span> <span class="p">{</span>
<span class="hll">         <span class="nx">externals</span><span class="o">:</span> <span class="p">{</span>
</span><span class="hll">            <span class="nx">leaflet</span><span class="o">:</span> <span class="p">{</span>
</span><span class="hll">               <span class="nx">root</span><span class="o">:</span> <span class="s2">&quot;L&quot;</span><span class="p">,</span>
</span><span class="hll">               <span class="nx">amd</span><span class="o">:</span> <span class="s2">&quot;leaflet&quot;</span><span class="p">,</span>
</span><span class="hll">               <span class="nx">commonjs</span><span class="o">:</span> <span class="s2">&quot;leaflet&quot;</span><span class="p">,</span>
</span><span class="hll">               <span class="nx">commonjs2</span><span class="o">:</span> <span class="s2">&quot;leaflet&quot;</span>
</span><span class="hll">            <span class="p">}</span>
</span><span class="hll">         <span class="p">},</span>
</span><span class="hll">         <span class="nx">output</span><span class="o">:</span> <span class="p">{</span>
</span><span class="hll">            <span class="nx">filename</span><span class="o">:</span> <span class="nx">filename</span><span class="p">,</span>
</span><span class="hll">            <span class="nx">libraryTarget</span><span class="o">:</span> <span class="s2">&quot;umd&quot;</span><span class="p">,</span>
</span><span class="hll">            <span class="nx">umdNamedDefine</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span><span class="hll">            <span class="nx">library</span><span class="o">:</span> <span class="s2">&quot;Lcz&quot;</span>
</span><span class="hll">         <span class="p">}</span>
</span>      <span class="p">});</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Hay algunas aclaraciones pertinentes:</p>
<ul>
<li><p class="first">El nombre del fichero de salida, cambia dependiendo de qué versión queramos
obtener. Esto permite generarlas todas y poder elegir cuál se usará desde
otra aplicación.</p>
</li>
<li><p class="first">Se importa el javascript de <a class="reference external" href="https://leafletjs.com">Leaflet</a> mediante el plugin <a class="reference external" href="https://webpack.js.org/plugins/provide-plugin/">Provide</a>, tal como
se enticipó al mostrar el código del <em>plugin</em>.</p>
</li>
<li><p class="first">Para la versión <em>bundle</em> se añade al punto de entrada el <abbr title="Cascading Style Sheets">CSS</abbr> de <a class="reference external" href="https://leafletjs.com">Leaflet</a>,
a fin de que sólamente genere el <abbr title="Cascading Style Sheets">CSS</abbr> en esta versión. En consonancia,
sólo es necesario tratar el <abbr title="Cascading Style Sheets">CSS</abbr> y los ficheros externos en esta versión.</p>
</li>
<li><p class="first">Para el resto de versiones que no incluyen <a class="reference external" href="https://leafletjs.com">Leaflet</a>:</p>
<ol class="loweralpha simple">
<li>Añadiendo <a class="reference external" href="https://webpack.js.org/configuration/externals/">externals</a>
se logra eliminar <a class="reference external" href="https://leafletjs.com">Leaflet</a> del fichero resultante, pero hay que indicar
cómo estará disponible la librería dependiendo de cómo se cargue.
Obviamente, esto es posible porque:</li>
<li>A <em>output</em> se añaden unos atributos que permiten construir un módulo <abbr title="Universal Module Definition">UMD</abbr>
que es válido tanto para usarlo directamente en el navegador (con
<a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/script">script</a>) como para usarlo en <em>NodeJS</em> (ya que puede cargarse con
<a class="reference internal" href="../03.node/03.modulos.html#module-commonjs"><span class="std std-ref">CommonJS</span></a>). El valor de <em>library</em> es el nombre de
la variable global que contendrá el objeto que exporta el módulo. Por
tanto, en este ejemplo, si la librería se carga directamente en el
navegador, <code class="code docutils literal notranslate"><span class="pre">window.Lcz</span></code> contendrá lo exportado. Como el módulo no
exporta nada, carece por completo de interés.</li>
</ol>
<div class="admonition seealso">
<p class="first admonition-title">Ver también</p>
<p class="last">Échele un ojo a la documentación oficial sobre la <a class="reference external" href="https://webpack.js.org/guides/author-libraries/">creación de
módulos con webpack</a>.</p>
</div>
</li>
</ul>
<p><a class="reference download internal" download="" href="../_downloads/33a7d247e9b42db90d4c2e68bd5872f4/webpack.development.js"><code class="xref download docutils literal notranslate"><span class="pre">webpack/webpack.development.js</span></code></a> no presenta novedades destacables;
simplemente, se ha optado por colocar los mapeos por separado:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="c1">// webpack/webpack.development.js</span>
<span class="kr">const</span> <span class="nx">merge</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;webpack-merge&#39;</span><span class="p">),</span>
      <span class="nx">webpack</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;webpack&quot;</span><span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">env</span> <span class="p">=&gt;</span> <span class="p">{</span>
   <span class="kr">const</span> <span class="nx">common</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./webpack.common.js&#39;</span><span class="p">)(</span><span class="nx">env</span><span class="p">);</span>
   <span class="kd">let</span> <span class="nx">filenamemap</span> <span class="o">=</span> <span class="sb">`</span><span class="si">${</span><span class="nx">common</span><span class="p">.</span><span class="nx">output</span><span class="p">.</span><span class="nx">filename</span><span class="si">}</span><span class="sb">.map`</span><span class="p">;</span>

   <span class="kr">const</span> <span class="nx">config</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">mode</span><span class="o">:</span> <span class="s2">&quot;development&quot;</span><span class="p">,</span>
      <span class="nx">devtool</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
         <span class="k">new</span> <span class="nx">webpack</span><span class="p">.</span><span class="nx">SourceMapDevToolPlugin</span><span class="p">({</span>
            <span class="nx">filename</span><span class="o">:</span> <span class="nx">filenamemap</span>
         <span class="p">})</span>
      <span class="p">]</span>
   <span class="p">}</span>

   <span class="k">return</span> <span class="nx">merge</span><span class="p">(</span><span class="nx">common</span><span class="p">,</span> <span class="nx">config</span><span class="p">);</span>

<span class="p">}</span>
</pre></div>
</div>
<p id="webpack-externals">Del mismo modo, tampoco, <a class="reference download internal" download="" href="../_downloads/0cb024d63f1c9e99064cb35a33405dc2/webpack.production.js"><code class="xref download docutils literal notranslate"><span class="pre">webpack/webpack.production.js</span></code></a> presenta novedades:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="c1">// webpack/webpack.production.js</span>
<span class="kr">const</span> <span class="nx">merge</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;webpack-merge&#39;</span><span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">env</span> <span class="p">=&gt;</span> <span class="p">{</span>
   <span class="kr">const</span> <span class="nx">common</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./webpack.common.js&#39;</span><span class="p">)(</span><span class="nx">env</span><span class="p">),</span>
         <span class="nx">config</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nx">mode</span><span class="o">:</span> <span class="s2">&quot;production&quot;</span><span class="p">,</span>
            <span class="nx">module</span><span class="o">:</span> <span class="p">{</span>
               <span class="nx">rules</span><span class="o">:</span> <span class="p">[</span>
                  <span class="p">{</span>
                     <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.js$/</span><span class="p">,</span>
                     <span class="nx">exclude</span><span class="o">:</span> <span class="sr">/node_modules/</span><span class="p">,</span>
                     <span class="nx">use</span><span class="o">:</span> <span class="p">{</span>
                        <span class="nx">loader</span><span class="o">:</span> <span class="s2">&quot;babel-loader&quot;</span><span class="p">,</span>
                        <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
                           <span class="nx">presets</span><span class="o">:</span> <span class="p">[[</span><span class="s2">&quot;@babel/env&quot;</span><span class="p">,</span> <span class="p">{</span>
                              <span class="nx">debug</span><span class="o">:</span> <span class="nx">env</span><span class="p">.</span><span class="nx">debug</span><span class="p">,</span>
                              <span class="nx">corejs</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span>
                              <span class="nx">useBuiltIns</span><span class="o">:</span> <span class="s2">&quot;usage&quot;</span>
                           <span class="p">}]]</span>
                        <span class="p">}</span>
                     <span class="p">}</span>
                  <span class="p">},</span>
               <span class="p">]</span>
            <span class="p">}</span>
         <span class="p">};</span>

   <span class="k">return</span> <span class="nx">merge</span><span class="p">(</span><span class="nx">common</span><span class="p">,</span> <span class="nx">config</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p class="first">Generamos los ficheros resultantes:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> npm run build
<span class="gp">$</span> npm run src
<span class="gp">$</span> npm run bundle
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Es importante recordar que en <code class="file docutils literal notranslate"><span class="pre">packages.json</span></code> hemos notado
como el fichero principal a <code class="file docutils literal notranslate"><span class="pre">dist/leaflet.iconzoom.js</span></code>, así que
conviene que al menos éste se genere.</p>
</div>
</li>
<li><p class="first">Hecho todo lo anterior, podemos rematar el repositorio <em>git</em>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> vim README.rst
<span class="gp">$</span> vim LICENSE
<span class="gp">$</span> git add .
<span class="gp">$</span> git commit <span class="s2">&quot;Primera implementación&quot;</span>
</pre></div>
</div>
<p>crear en <a class="reference external" href="https://github.com">Github</a> un repositorio homónimo (<em>leaflet.iconzoom</em>) sin inicializar
con nuestro usuario, y subir el código a él:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> git remote add origin https://github.com/miusuario/leaflet.iconzoom.git
<span class="gp">$</span> git push -u origin master
</pre></div>
</div>
</li>
</ol>
<p>El resultado es <a class="reference external" href="https://github.com/sio2sio2/leaflet.iconzoom/tree/v0.1.0">este repositorio de Github</a>.</p>
</div>
<div class="section" id="aplicacion-web">
<h3>4.3.2. Aplicación web<a class="headerlink" href="#aplicacion-web" title="Enlazar permanentemente con este título">¶</a></h3>
<p>La aplicación web desarrolla una página muy simple que usa el <em>plugin</em> anterior.
Como es una aplicación final, a diferencia del caso del <em>plugin</em>, sólo
necesita dos sabores:</p>
<ul class="simple">
<li>El optimizado y portable para producción, que incluirá todas las dependencias
(<a class="reference external" href="https://leafletjs.com">Leaflet</a> en este caso).</li>
<li>El apropiado para la depuración, durante el desarrollo.</li>
</ul>
<ol class="arabic">
<li><p class="first">Preparamos el directorio de trabajo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> mkdir test.leaflet.iconzoom
<span class="gp">$</span> <span class="nb">cd</span> test.leaflet.iconzoom
<span class="gp">$</span> npm init -y
</pre></div>
</div>
</li>
<li><p class="first">Instalamos el <em>software</em> preciso:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> npm install --save-dev webpack webpack-dev-server webpack-cli webpack-merge
<span class="gp">$</span> npm install --save-dev babel-loader @babel/core @babel/cli @babel/preset-env
<span class="gp">$</span> npm install --save-dev html-loader html-webpack-plugin
<span class="gp">$</span> npm install --save-dev css-loader mini-css-extract-plugin
<span class="gp">$</span> npm install --save-dev url-loader file-loader
<span class="gp">$</span> npm install --save-dev sass-loader node-sass
<span class="gp">$</span> npm install --save-dev postcss-loader autoprefixer
<span class="gp">$</span> npm install core-js leaflet
<span class="gp">$</span> npm install git+https://github.com/sio2sio2/leaflet.iconzoom.git
</pre></div>
</div>
</li>
<li><p class="first">Configuramos los <em>scripts</em>:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;scripts&quot;</span><span class="o">:</span> <span class="p">{</span>
  <span class="s2">&quot;build&quot;</span><span class="o">:</span> <span class="s2">&quot;webpack --env.output=min&quot;</span><span class="p">,</span>
  <span class="s2">&quot;debug&quot;</span><span class="o">:</span> <span class="s2">&quot;webpack-dev-server --env.output=debug --open&quot;</span>
<span class="p">},</span>
</pre></div>
</div>
<p>El primero de los cuales, genera la aplicación para producción y el segundo
es útil para depurar la aplicación.</p>
</li>
<li><p class="first">Creamos los ficheros que conforman el proyecto:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>+ src
   +-- index.html
   +-- js
   |    +-- index.js
   +-- sass
        +-- index.sass
</pre></div>
</div>
<ol class="loweralpha">
<li><p class="first">Creamos la página <a class="reference download internal" download="" href="../_downloads/039c2a9d4ccd5b77d04b8a707dc8af42/index.html"><code class="xref download docutils literal notranslate"><span class="pre">src/index.html</span></code></a>:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;en&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;width=device-width, initial-scale=1&quot;</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Prueba con elemento GeoJSON<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Prueba con Leaflet.iconzoom<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;map&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">template</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;icono&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">svg</span> <span class="na">xmlns</span><span class="o">=</span><span class="s">&#39;http://www.w3.org/2000/svg&#39;</span> <span class="na">viewBox</span><span class="o">=</span><span class="s">&quot;0 0 20 25&quot;</span><span class="p">&gt;</span>
         <span class="p">&lt;</span><span class="nt">rect</span> <span class="na">x</span><span class="o">=</span><span class="s">&#39;0&#39;</span> <span class="na">y</span><span class="o">=</span><span class="s">&#39;0&#39;</span> <span class="na">width</span><span class="o">=</span><span class="s">&#39;20&#39;</span> <span class="na">height</span><span class="o">=</span><span class="s">&#39;10&#39;</span> <span class="na">fill</span><span class="o">=</span><span class="s">&#39;#5a7cd2&#39;</span><span class="p">/&gt;</span>
         <span class="p">&lt;</span><span class="nt">rect</span> <span class="na">x</span><span class="o">=</span><span class="s">&#39;0&#39;</span> <span class="na">y</span><span class="o">=</span><span class="s">&#39;15&#39;</span> <span class="na">width</span><span class="o">=</span><span class="s">&#39;20&#39;</span> <span class="na">height</span><span class="o">=</span><span class="s">&#39;10&#39;</span> <span class="na">fill</span><span class="o">=</span><span class="s">&#39;#5d52cf&#39;</span><span class="p">/&gt;</span>
      <span class="p">&lt;/</span><span class="nt">svg</span><span class="p">&gt;</span>
   <span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>Como puede verse, es la página cruda sin enlaces a <a class="reference external" href="https://leafletjs.com">Leaflet</a>, el plugin
anterior o el <em>script</em> que crea el mapa.</p>
</li>
<li><p class="first">Definimos el estilo (con <abbr title="Syntactically Awesome Style Sheets">SASS</abbr>) en <a class="reference download internal" download="" href="../_downloads/1d8b0748ee785d18ea600c2910f2b073/index.sass"><code class="xref download docutils literal notranslate"><span class="pre">src/sass/index.sass</span></code></a>:</p>
<div class="highlight-sass notranslate"><div class="highlight"><pre><span></span><span class="nt">html</span><span class="o">,</span> <span class="nt">body</span>
   <span class="na">height</span><span class="o">:</span> <span class="mi">100</span><span class="kt">%</span>
   <span class="na">width</span><span class="o">:</span> <span class="mi">100</span><span class="kt">%</span>
   <span class="na">margin</span><span class="o">:</span> <span class="mi">0</span>

<span class="nt">h1</span>
   <span class="na">height</span><span class="o">:</span> <span class="mi">40</span><span class="kt">px</span>
   <span class="na">background-color</span><span class="o">:</span> <span class="mh">#ee6</span>
   <span class="na">margin-block-start</span><span class="o">:</span> <span class="mi">0</span>
   <span class="na">margin-block-end</span><span class="o">:</span> <span class="mi">0</span>
   <span class="na">text-align</span><span class="o">:</span> <span class="no">center</span>
   <span class="na">box-sizing</span><span class="o">:</span> <span class="no">border</span><span class="o">-</span><span class="n">box</span>

<span class="nn">#map</span>
   <span class="na">height</span><span class="o">:</span> <span class="nf">calc</span><span class="p">(</span><span class="mi">100</span><span class="kt">%</span> <span class="o">-</span> <span class="mi">40</span><span class="kt">px</span><span class="p">)</span>
   <span class="na">width</span><span class="o">:</span> <span class="mi">100</span><span class="kt">%</span>
   <span class="na">box-sizing</span><span class="o">:</span> <span class="no">border</span><span class="o">-</span><span class="n">box</span>
</pre></div>
</div>
</li>
<li><p class="first">Y el propio <em>script</em> <a class="reference download internal" download="" href="../_downloads/47b656a8aec0cb14559be72c48bcf7d9/index.js"><code class="xref download docutils literal notranslate"><span class="pre">src/js/index.js</span></code></a>:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">import</span> <span class="nx">L</span> <span class="nx">from</span> <span class="s2">&quot;leaflet&quot;</span><span class="p">;</span>
<span class="kr">import</span> <span class="s2">&quot;leaflet.iconzoom&quot;</span><span class="p">;</span>

<span class="kr">import</span> <span class="s2">&quot;leaflet/dist/leaflet.css&quot;</span><span class="p">;</span>
<span class="kr">import</span> <span class="s2">&quot;app/src/sass/index.sass&quot;</span><span class="p">;</span>
<span class="kr">import</span> <span class="s2">&quot;app/src/images/logo.svg&quot;</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">encodeSVG</span><span class="p">(</span><span class="nx">svg</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">type</span> <span class="o">=</span> <span class="s2">&quot;image/svg+xml&quot;</span><span class="p">;</span>

   <span class="k">return</span> <span class="s2">&quot;data:&quot;</span> <span class="o">+</span> <span class="nx">type</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span> <span class="o">+</span>
      <span class="nx">svg</span><span class="p">.</span><span class="nx">outerHTML</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/(:?&lt;|&gt;|&quot;|&#39;|#|\s+)/g</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span> <span class="p">{</span>
         <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;&lt;&#39;</span><span class="o">:</span> <span class="s1">&#39;%3C&#39;</span><span class="p">,</span>
            <span class="s1">&#39;&gt;&#39;</span><span class="o">:</span> <span class="s1">&#39;%3E&#39;</span><span class="p">,</span>
            <span class="s1">&#39;&quot;&#39;</span><span class="o">:</span> <span class="s2">&quot;%22&quot;</span><span class="p">,</span>
            <span class="s2">&quot;&#39;&quot;</span><span class="o">:</span> <span class="s2">&quot;%27&quot;</span><span class="p">,</span>
            <span class="s1">&#39;#&#39;</span><span class="o">:</span> <span class="s1">&#39;%23&#39;</span>
         <span class="p">}[</span><span class="nx">c</span><span class="p">]</span> <span class="o">||</span> <span class="s2">&quot; &quot;</span><span class="p">;</span>
     <span class="p">});</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">Icon</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">Icon</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
   <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">factor</span><span class="o">:</span>       <span class="mf">1.25</span><span class="p">,</span> <span class="c1">// Provoca que se haga zoom al pasar sobre el icono</span>
      <span class="nx">iconSize</span><span class="o">:</span>     <span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">25</span><span class="p">],</span>
      <span class="nx">iconAnchor</span><span class="o">:</span>   <span class="p">[</span><span class="mf">12.5</span><span class="p">,</span> <span class="mi">25</span><span class="p">],</span>
   <span class="p">}</span>
<span class="p">})</span>

<span class="nb">window</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
   <span class="kr">const</span> <span class="nx">map</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="s1">&#39;map&#39;</span><span class="p">).</span><span class="nx">setView</span><span class="p">([</span><span class="mf">37.07</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.27</span><span class="p">],</span> <span class="mi">9</span><span class="p">);</span>
   <span class="nx">map</span><span class="p">.</span><span class="nx">zoomControl</span><span class="p">.</span><span class="nx">setPosition</span><span class="p">(</span><span class="s1">&#39;bottomright&#39;</span><span class="p">);</span>
   <span class="nx">L</span><span class="p">.</span><span class="nx">tileLayer</span><span class="p">(</span><span class="s1">&#39;https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png&#39;</span><span class="p">,</span> <span class="p">{</span>
     <span class="nx">attribution</span><span class="o">:</span> <span class="s1">&#39;&amp;copy; &lt;a href=&quot;http://osm.org/copyright&quot;&gt;OpenStreetMap&lt;/a&gt; contributors&#39;</span><span class="p">,</span>
     <span class="nx">maxZoom</span><span class="o">:</span> <span class="mi">18</span>
   <span class="p">}).</span><span class="nx">addTo</span><span class="p">(</span><span class="nx">map</span><span class="p">);</span>

   <span class="kr">const</span> <span class="nx">svg</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&quot;template&quot;</span><span class="p">).</span><span class="nx">content</span><span class="p">.</span><span class="nx">firstElementChild</span><span class="p">;</span>

   <span class="c1">// Objeto geojson</span>
   <span class="kr">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;Feature&quot;</span><span class="p">,</span>
      <span class="nx">properties</span><span class="o">:</span> <span class="p">{</span>
         <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;Una marca&quot;</span><span class="p">,</span>
         <span class="nx">popupContent</span><span class="o">:</span> <span class="s2">&quot;Soy una marca&quot;</span>
      <span class="p">},</span>
      <span class="nx">geometry</span><span class="o">:</span> <span class="p">{</span>
         <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;Point&quot;</span><span class="p">,</span>
         <span class="nx">coordinates</span><span class="o">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">6.27</span><span class="p">,</span> <span class="mf">37.07</span><span class="p">]</span>
      <span class="p">}</span>
   <span class="p">}</span>

   <span class="kd">function</span> <span class="nx">onEachFeature</span><span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="nx">l</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">l</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
         <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">l</span> <span class="o">===</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">);</span>  <span class="c1">// La marca.</span>
         <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">f</span> <span class="o">===</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">feature</span><span class="p">);</span> <span class="c1">// El objeto geojson.</span>
         <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">layer</span> <span class="o">===</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">feature</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">layer</span><span class="p">);</span>  <span class="c1">// La capa que contiene los objetos.</span>
         <span class="nx">alert</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">feature</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
      <span class="p">});</span>
   <span class="p">}</span>

   <span class="kd">function</span> <span class="nx">pointToLayer</span><span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="nx">p</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">f</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">marker</span><span class="p">)</span> <span class="p">{</span>
         <span class="nx">f</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">marker</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">L</span><span class="p">.</span><span class="nx">Marker</span><span class="p">(</span><span class="nx">p</span><span class="p">,</span> <span class="p">{</span><span class="nx">icon</span><span class="o">:</span> <span class="k">new</span> <span class="nx">Icon</span><span class="p">({</span><span class="nx">iconUrl</span><span class="o">:</span> <span class="nx">encodeSVG</span><span class="p">(</span><span class="nx">svg</span><span class="p">)})});</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">f</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">marker</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="kr">const</span> <span class="nx">SVGLayer</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">GeoJSON</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
      <span class="nx">addData</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">geojson</span><span class="p">)</span> <span class="p">{</span>
         <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">geojson</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">geojson</span><span class="p">.</span><span class="nx">features</span><span class="p">)</span> <span class="nx">geojson</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">layer</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
         <span class="k">return</span> <span class="nx">L</span><span class="p">.</span><span class="nx">GeoJSON</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">addData</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">geojson</span><span class="p">);</span>
      <span class="p">}</span>
   <span class="p">});</span>

   <span class="kr">const</span> <span class="nx">layer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SVGLayer</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">onEachFeature</span><span class="o">:</span> <span class="nx">onEachFeature</span><span class="p">,</span>
      <span class="nx">pointToLayer</span><span class="o">:</span> <span class="nx">pointToLayer</span>
   <span class="p">}).</span><span class="nx">addTo</span><span class="p">(</span><span class="nx">map</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">En este caso, como desarrollamos una aplicación final, no
necesitamos tener ninguna prevención sobre cómo importamos <a class="reference external" href="https://leafletjs.com">Leaflet</a> o
el propia plugin que previamente hemos desarrollado.</p>
</div>
</li>
</ol>
</li>
<li><p class="first">Y creamos la configuración para <strong class="program">webpack</strong> con</p>
<p><a class="reference download internal" download="" href="../_downloads/f694f049e46eee3cb5d4a6f24bc58bc8/webpack.config.js"><code class="xref download docutils literal notranslate"><span class="pre">webpack.config.js</span></code></a>:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="c1">// webpack.config.js</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">env</span> <span class="p">=&gt;</span> <span class="p">{</span>
   <span class="kd">let</span> <span class="nx">mode</span><span class="p">;</span>

   <span class="k">switch</span><span class="p">(</span><span class="nx">env</span><span class="p">.</span><span class="nx">output</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">case</span> <span class="s2">&quot;debug&quot;</span><span class="o">:</span>
         <span class="nx">mode</span> <span class="o">=</span> <span class="s2">&quot;development&quot;</span><span class="p">;</span>
         <span class="k">break</span><span class="p">;</span>
      <span class="k">default</span><span class="o">:</span>
         <span class="nx">mode</span> <span class="o">=</span> <span class="s2">&quot;production&quot;</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="k">return</span> <span class="nx">require</span><span class="p">(</span><span class="sb">`./webpack/webpack.</span><span class="si">${</span><span class="nx">mode</span><span class="si">}</span><span class="sb">.js`</span><span class="p">)(</span><span class="nx">env</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p><a class="reference download internal" download="" href="../_downloads/f1946b7a9623ea433f15f3ddf1a1405b/webpack.common.js"><code class="xref download docutils literal notranslate"><span class="pre">webpack/webpack.common.js</span></code></a>, que
hace que los ficheros resultantes se generen dentro de <code class="file docutils literal notranslate"><span class="pre">docs/</span></code><a class="footnote-reference" href="#id24" id="id12">[11]</a>:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="c1">// webpack/webpack.common.js</span>
<span class="kr">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;path&quot;</span><span class="p">),</span>
      <span class="nx">HtmlWebPackPlugin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;html-webpack-plugin&quot;</span><span class="p">),</span>
      <span class="nx">MiniCssExtractPlugin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;mini-css-extract-plugin&quot;</span><span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">env</span> <span class="p">=&gt;</span> <span class="p">{</span>
   <span class="k">return</span> <span class="p">{</span>
      <span class="nx">entry</span><span class="o">:</span> <span class="s2">&quot;./src/js/index.js&quot;</span><span class="p">,</span>
      <span class="nx">output</span><span class="o">:</span> <span class="p">{</span>
<span class="hll">         <span class="nx">path</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s2">&quot;../docs&quot;</span><span class="p">),</span>
</span>         <span class="nx">filename</span><span class="o">:</span> <span class="sb">`js/[name].bundle.js`</span>
      <span class="p">},</span>
      <span class="nx">resolve</span><span class="o">:</span> <span class="p">{</span>
         <span class="nx">alias</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">app</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s2">&quot;..&quot;</span><span class="p">)</span>
         <span class="p">}</span>
      <span class="p">},</span>
      <span class="nx">module</span><span class="o">:</span> <span class="p">{</span>
         <span class="nx">rules</span><span class="o">:</span> <span class="p">[</span>
            <span class="p">{</span>
               <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.html$/</span><span class="p">,</span>
               <span class="nx">use</span><span class="o">:</span> <span class="p">{</span>
                  <span class="nx">loader</span><span class="o">:</span> <span class="s2">&quot;html-loader&quot;</span><span class="p">,</span>
                  <span class="nx">options</span><span class="o">:</span> <span class="p">{</span> <span class="nx">minimize</span><span class="o">:</span> <span class="kc">true</span> <span class="p">}</span>
               <span class="p">}</span>
            <span class="p">},</span>
            <span class="p">{</span>
               <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.(css|sass)$/</span><span class="p">,</span>
               <span class="nx">use</span><span class="o">:</span> <span class="p">[</span><span class="nx">MiniCssExtractPlugin</span><span class="p">.</span><span class="nx">loader</span><span class="p">,</span>
                     <span class="s2">&quot;css-loader&quot;</span><span class="p">,</span>
                     <span class="p">{</span> 
                        <span class="nx">loader</span><span class="o">:</span> <span class="s2">&quot;postcss-loader&quot;</span><span class="p">,</span>
                        <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
                           <span class="nx">plugins</span><span class="o">:</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;autoprefixer&quot;</span><span class="p">)]</span>
                        <span class="p">}</span>
                     <span class="p">},</span>
                     <span class="s2">&quot;sass-loader&quot;</span><span class="p">]</span>
            <span class="p">},</span>
            <span class="p">{</span>
               <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.(png|jpe?g|gif|svg)$/i</span><span class="p">,</span>
               <span class="nx">use</span><span class="o">:</span> <span class="p">[</span>
                  <span class="s1">&#39;url-loader?limit=4096&amp;name=images/[name].[ext]&#39;</span>
               <span class="p">]</span>
            <span class="p">}</span>
         <span class="p">]</span>
      <span class="p">},</span>
      <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
         <span class="k">new</span> <span class="nx">HtmlWebPackPlugin</span><span class="p">({</span>
            <span class="nx">template</span><span class="o">:</span> <span class="s2">&quot;src/index.html&quot;</span><span class="p">,</span>
            <span class="c1">//filename: &quot;index.html&quot;   // Es el valor predeterminado</span>
         <span class="p">}),</span>
         <span class="k">new</span> <span class="nx">MiniCssExtractPlugin</span><span class="p">({</span>
            <span class="nx">filename</span><span class="o">:</span> <span class="s2">&quot;css/[name].css&quot;</span><span class="p">,</span>
            <span class="nx">chunkFilename</span><span class="o">:</span> <span class="s2">&quot;[id].css&quot;</span>
         <span class="p">})</span>
      <span class="p">]</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><a class="reference download internal" download="" href="../_downloads/b7cc9979478fa0e987317bb3f5d0228e/webpack.production.js"><code class="xref download docutils literal notranslate"><span class="pre">webpack.production.js</span></code></a>:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="c1">// webpack/webpack.production.js</span>
<span class="kr">const</span> <span class="nx">merge</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;webpack-merge&#39;</span><span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">env</span> <span class="p">=&gt;</span> <span class="p">{</span>
   <span class="kr">const</span> <span class="nx">common</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./webpack.common.js&#39;</span><span class="p">)(</span><span class="nx">env</span><span class="p">),</span>
         <span class="nx">config</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nx">mode</span><span class="o">:</span> <span class="s2">&quot;production&quot;</span><span class="p">,</span>
            <span class="nx">module</span><span class="o">:</span> <span class="p">{</span>
               <span class="nx">rules</span><span class="o">:</span> <span class="p">[</span>
                  <span class="p">{</span>
                     <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.js$/</span><span class="p">,</span>
                     <span class="nx">exclude</span><span class="o">:</span> <span class="sr">/node_modules/</span><span class="p">,</span>
                     <span class="nx">use</span><span class="o">:</span> <span class="p">{</span>
                        <span class="nx">loader</span><span class="o">:</span> <span class="s2">&quot;babel-loader&quot;</span><span class="p">,</span>
                        <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
                           <span class="nx">presets</span><span class="o">:</span> <span class="p">[[</span><span class="s2">&quot;@babel/env&quot;</span><span class="p">,</span> <span class="p">{</span>
                              <span class="nx">debug</span><span class="o">:</span> <span class="nx">env</span><span class="p">.</span><span class="nx">debug</span><span class="p">,</span>
                              <span class="nx">corejs</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span>
                              <span class="nx">useBuiltIns</span><span class="o">:</span> <span class="s2">&quot;usage&quot;</span>
                           <span class="p">}]]</span>
                        <span class="p">}</span>
                     <span class="p">}</span>
                  <span class="p">},</span>
               <span class="p">]</span>
            <span class="p">}</span>
         <span class="p">};</span>

   <span class="k">return</span> <span class="nx">merge</span><span class="p">(</span><span class="nx">common</span><span class="p">,</span> <span class="nx">config</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p><a class="reference download internal" download="" href="../_downloads/b1114df7b9f40a06b3118f608458d6ca/webpack.development.js"><code class="xref download docutils literal notranslate"><span class="pre">webpack.development.js</span></code></a>:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="c1">// webpack/webpack.development.js</span>
<span class="kr">const</span> <span class="nx">merge</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;webpack-merge&#39;</span><span class="p">),</span>
      <span class="nx">webpack</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;webpack&quot;</span><span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">env</span> <span class="p">=&gt;</span> <span class="p">{</span>
   <span class="kr">const</span> <span class="nx">common</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./webpack.common.js&#39;</span><span class="p">)(</span><span class="nx">env</span><span class="p">);</span>

   <span class="k">return</span> <span class="nx">merge</span><span class="p">(</span><span class="nx">common</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">mode</span><span class="o">:</span> <span class="s2">&quot;development&quot;</span><span class="p">,</span>
      <span class="nx">devtool</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="nx">devServer</span><span class="o">:</span> <span class="p">{</span>
         <span class="nx">contentBase</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
         <span class="nx">open</span><span class="o">:</span> <span class="s2">&quot;chromium&quot;</span>
      <span class="p">},</span>
      <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
         <span class="k">new</span> <span class="nx">webpack</span><span class="p">.</span><span class="nx">SourceMapDevToolPlugin</span><span class="p">({</span>
            <span class="nx">filename</span><span class="o">:</span> <span class="s1">&#39;js/[name].js.map&#39;</span>
         <span class="p">})</span>
      <span class="p">]</span>
   <span class="p">});</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p class="first">Generamos el resultado:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> npm run build
</pre></div>
</div>
</li>
<li><p class="first">Por último, se remata y publica el repositorio:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> vim README.rst
<span class="gp">$</span> vim LICENSE
<span class="gp">$</span> git add --all .
<span class="gp">$</span> git commit -m <span class="s2">&quot;Primera implementación&quot;</span>

<span class="gp">$</span> git remote add origin https://github.com/sio2sio2/test.iconzoom.git
<span class="gp">$</span> git push -u origin master
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Para que el ejemplo sea visitable, en <a class="reference external" href="https://github.com">Github</a> dentro de <em>Settings</em>,
la publicación del directorio <code class="file docutils literal notranslate"><span class="pre">/docs</span></code> de la rama <em>master</em>.</p>
</div>
</li>
</ol>
<p>El resultado está publicado en <a class="reference external" href="https://github.com/sio2sio2/test.iconzoom">este segundo repositorio</a>.</p>
</div>
<div class="section" id="plugin-con-ejemplo">
<h3>4.3.3. Plugin con ejemplo<a class="headerlink" href="#plugin-con-ejemplo" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Cuando se desarrolla una librería y no una aplicación, es indispensable crear al
menos una página de ejemplo de aplicación por dos razones:</p>
<ol class="arabic simple">
<li>Porque un ejemplo de aplicación que ilustre el uso es muy recomendable para
mostrar a terceros cómo debe programar con la librería</li>
<li>Porque la propia página sirve para probar y depurar el código.</li>
</ol>
<p>La primera razón implica que todo el código del ejemplo (<abbr title="HyperText Markup Language">HTML</abbr>, <abbr title="Cascading Style Sheets">CSS</abbr> y
<em>Javascript</em>) sea absolutamente claro a la lectura de un programador humano, lo
cual se consigue escribiendo a mano los ficheros que componen el ejemplo e
impidiendo que <strong class="program">webpack</strong> pueda obrar transformación alguna.</p>
<p>Siguiendo este principio, tomemos el directorio de trabajo del <a class="reference internal" href="#webpack-ej-plugin"><span class="std std-ref">ejemplo de
desarrollo del plugin</span></a> y añadamos un directorio
<code class="file docutils literal notranslate"><span class="pre">examples/</span></code><a class="footnote-reference" href="#id25" id="id13">[12]</a> con todo el código que desarrolla el ejemplo:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>+-- examples
      +-- index.html
      +-- js/
      |   +-- main.js
      +-- css/
          +-- main.css
</pre></div>
</div>
<p><a class="reference download internal" download="" href="../_downloads/8fcae6d35e0e28cc1e93eb5187aad99b/index.html"><code class="xref download docutils literal notranslate"><span class="pre">index.html</span></code></a>, que escribimos por completo a
mano tendrá este contenido:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;es&quot;</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Prueba con Leaflet.iconzoom<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>

   <span class="c">&lt;!-- Leaflet --&gt;</span>
   <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;https://unpkg.com/leaflet@1.5.1/dist/leaflet.css&quot;</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://unpkg.com/leaflet@1.5.1/dist/leaflet.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

   <span class="c">&lt;!-- Plugin --&gt;</span>
   <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;../dist/leaflet.iconzoom.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

   <span class="c">&lt;!-- Código para el ejemplo --&gt;</span>
   <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;css/main.css&quot;</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;js/main.js&quot;</span> <span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

   <span class="c">&lt;!-- BODY --&gt;</span>

   <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Prueba con Leaflet.iconzoom<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;map&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

   <span class="c">&lt;!-- Icono para la marca --&gt;</span>
   <span class="p">&lt;</span><span class="nt">template</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;icono&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">svg</span> <span class="na">xmlns</span><span class="o">=</span><span class="s">&#39;http://www.w3.org/2000/svg&#39;</span> <span class="na">viewBox</span><span class="o">=</span><span class="s">&quot;0 0 20 25&quot;</span><span class="p">&gt;</span>
         <span class="p">&lt;</span><span class="nt">rect</span> <span class="na">x</span><span class="o">=</span><span class="s">&#39;0&#39;</span> <span class="na">y</span><span class="o">=</span><span class="s">&#39;0&#39;</span> <span class="na">width</span><span class="o">=</span><span class="s">&#39;20&#39;</span> <span class="na">height</span><span class="o">=</span><span class="s">&#39;10&#39;</span> <span class="na">fill</span><span class="o">=</span><span class="s">&#39;#5a7cd2&#39;</span><span class="p">/&gt;</span>
         <span class="p">&lt;</span><span class="nt">rect</span> <span class="na">x</span><span class="o">=</span><span class="s">&#39;0&#39;</span> <span class="na">y</span><span class="o">=</span><span class="s">&#39;15&#39;</span> <span class="na">width</span><span class="o">=</span><span class="s">&#39;20&#39;</span> <span class="na">height</span><span class="o">=</span><span class="s">&#39;10&#39;</span> <span class="na">fill</span><span class="o">=</span><span class="s">&#39;#5d52cf&#39;</span><span class="p">/&gt;</span>
      <span class="p">&lt;/</span><span class="nt">svg</span><span class="p">&gt;</span>
   <span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
<p><a class="reference download internal" download="" href="../_downloads/456d02e7cad96cefa1fefa1da61d65a9/main.js"><code class="xref download docutils literal notranslate"><span class="pre">js/main.js</span></code></a>, este otro:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">encodeSVG</span><span class="p">(</span><span class="nx">svg</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">type</span> <span class="o">=</span> <span class="s2">&quot;image/svg+xml&quot;</span><span class="p">;</span>

   <span class="k">return</span> <span class="s2">&quot;data:&quot;</span> <span class="o">+</span> <span class="nx">type</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span> <span class="o">+</span>
      <span class="nx">svg</span><span class="p">.</span><span class="nx">outerHTML</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/(:?&lt;|&gt;|&quot;|&#39;|#|\s+)/g</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span> <span class="p">{</span>
         <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;&lt;&#39;</span><span class="o">:</span> <span class="s1">&#39;%3C&#39;</span><span class="p">,</span>
            <span class="s1">&#39;&gt;&#39;</span><span class="o">:</span> <span class="s1">&#39;%3E&#39;</span><span class="p">,</span>
            <span class="s1">&#39;&quot;&#39;</span><span class="o">:</span> <span class="s2">&quot;%22&quot;</span><span class="p">,</span>
            <span class="s2">&quot;&#39;&quot;</span><span class="o">:</span> <span class="s2">&quot;%27&quot;</span><span class="p">,</span>
            <span class="s1">&#39;#&#39;</span><span class="o">:</span> <span class="s1">&#39;%23&#39;</span>
         <span class="p">}[</span><span class="nx">c</span><span class="p">]</span> <span class="o">||</span> <span class="s2">&quot; &quot;</span><span class="p">;</span>
     <span class="p">});</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">Icon</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">Icon</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
   <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">factor</span><span class="o">:</span>       <span class="mf">1.25</span><span class="p">,</span> <span class="c1">// Provoca que se haga zoom al pasar sobre el icono</span>
      <span class="nx">iconSize</span><span class="o">:</span>     <span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">25</span><span class="p">],</span>
      <span class="nx">iconAnchor</span><span class="o">:</span>   <span class="p">[</span><span class="mf">12.5</span><span class="p">,</span> <span class="mi">25</span><span class="p">],</span>
   <span class="p">}</span>
<span class="p">});</span>

<span class="nb">window</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
   <span class="kr">const</span> <span class="nx">map</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="s1">&#39;map&#39;</span><span class="p">).</span><span class="nx">setView</span><span class="p">([</span><span class="mf">37.07</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.27</span><span class="p">],</span> <span class="mi">9</span><span class="p">);</span>
   <span class="nx">map</span><span class="p">.</span><span class="nx">zoomControl</span><span class="p">.</span><span class="nx">setPosition</span><span class="p">(</span><span class="s1">&#39;bottomright&#39;</span><span class="p">);</span>
   <span class="nx">L</span><span class="p">.</span><span class="nx">tileLayer</span><span class="p">(</span><span class="s1">&#39;https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png&#39;</span><span class="p">,</span> <span class="p">{</span>
     <span class="nx">attribution</span><span class="o">:</span> <span class="s1">&#39;&amp;copy; &lt;a href=&quot;http://osm.org/copyright&quot;&gt;OpenStreetMap&lt;/a&gt; contributors&#39;</span><span class="p">,</span>
     <span class="nx">maxZoom</span><span class="o">:</span> <span class="mi">18</span>
   <span class="p">}).</span><span class="nx">addTo</span><span class="p">(</span><span class="nx">map</span><span class="p">);</span>

   <span class="kr">const</span> <span class="nx">svg</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&quot;template&quot;</span><span class="p">).</span><span class="nx">content</span><span class="p">.</span><span class="nx">firstElementChild</span><span class="p">;</span>

   <span class="c1">// Objeto geojson</span>
   <span class="kr">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;Feature&quot;</span><span class="p">,</span>
      <span class="nx">properties</span><span class="o">:</span> <span class="p">{</span>
         <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;Una marca&quot;</span><span class="p">,</span>
         <span class="nx">popupContent</span><span class="o">:</span> <span class="s2">&quot;Soy una marca&quot;</span>
      <span class="p">},</span>
      <span class="nx">geometry</span><span class="o">:</span> <span class="p">{</span>
         <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;Point&quot;</span><span class="p">,</span>
         <span class="nx">coordinates</span><span class="o">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">6.27</span><span class="p">,</span> <span class="mf">37.07</span><span class="p">]</span>
      <span class="p">}</span>
   <span class="p">}</span>

   <span class="kd">function</span> <span class="nx">onEachFeature</span><span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="nx">l</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">l</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
         <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">l</span> <span class="o">===</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">);</span>  <span class="c1">// La marca.</span>
         <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">f</span> <span class="o">===</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">feature</span><span class="p">);</span> <span class="c1">// El objeto geojson.</span>
         <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">layer</span> <span class="o">===</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">feature</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">layer</span><span class="p">);</span>  <span class="c1">// La capa que contiene los objetos.</span>
         <span class="nx">alert</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">feature</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
      <span class="p">});</span>
   <span class="p">}</span>

   <span class="kd">function</span> <span class="nx">pointToLayer</span><span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="nx">p</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">f</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">marker</span><span class="p">)</span> <span class="p">{</span>
         <span class="nx">f</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">marker</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">L</span><span class="p">.</span><span class="nx">Marker</span><span class="p">(</span><span class="nx">p</span><span class="p">,</span> <span class="p">{</span><span class="nx">icon</span><span class="o">:</span> <span class="k">new</span> <span class="nx">Icon</span><span class="p">({</span><span class="nx">iconUrl</span><span class="o">:</span> <span class="nx">encodeSVG</span><span class="p">(</span><span class="nx">svg</span><span class="p">)})});</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">f</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">marker</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="kr">const</span> <span class="nx">SVGLayer</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">GeoJSON</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
      <span class="nx">addData</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">geojson</span><span class="p">)</span> <span class="p">{</span>
         <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">geojson</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">geojson</span><span class="p">.</span><span class="nx">features</span><span class="p">)</span> <span class="nx">geojson</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">layer</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
         <span class="k">return</span> <span class="nx">L</span><span class="p">.</span><span class="nx">GeoJSON</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">addData</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">geojson</span><span class="p">);</span>
      <span class="p">}</span>
   <span class="p">});</span>

   <span class="kr">const</span> <span class="nx">layer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SVGLayer</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">onEachFeature</span><span class="o">:</span> <span class="nx">onEachFeature</span><span class="p">,</span>
      <span class="nx">pointToLayer</span><span class="o">:</span> <span class="nx">pointToLayer</span>
   <span class="p">}).</span><span class="nx">addTo</span><span class="p">(</span><span class="nx">map</span><span class="p">);</span>

<span class="p">}</span>
</pre></div>
</div>
<p>y <a class="reference download internal" download="" href="../_downloads/744e39db7bd328293eb266eac158f58b/main.css"><code class="xref download docutils literal notranslate"><span class="pre">css/main.css</span></code></a>, finalmente, este:</p>
<div class="highlight-css notranslate"><div class="highlight"><pre><span></span><span class="nt">html</span><span class="o">,</span> <span class="nt">body</span> <span class="p">{</span>
   <span class="k">height</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
   <span class="k">width</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
   <span class="k">margin</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">h1</span> <span class="p">{</span>
   <span class="k">height</span><span class="p">:</span> <span class="mi">40</span><span class="kt">px</span><span class="p">;</span>
   <span class="k">background-color</span><span class="p">:</span> <span class="mh">#ee6</span><span class="p">;</span>
   <span class="n">margin-block-start</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
   <span class="n">margin-block-end</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
   <span class="k">text-align</span><span class="p">:</span> <span class="kc">center</span><span class="p">;</span>
   <span class="k">box-sizing</span><span class="p">:</span> <span class="kc">border-box</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">#</span><span class="nn">map</span> <span class="p">{</span>
   <span class="k">height</span><span class="p">:</span> <span class="nb">calc</span><span class="p">(</span><span class="mi">100</span><span class="kt">%</span> <span class="o">-</span> <span class="mi">40</span><span class="kt">px</span><span class="p">);</span>
   <span class="k">width</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
   <span class="k">box-sizing</span><span class="p">:</span> <span class="kc">border-box</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Si se han generado los ficheros en <code class="file docutils literal notranslate"><span class="pre">dist/</span></code>, el ejemplo es perfectamente
funcional y, si se ejecuta en el directorio de trabajo
<strong class="program">webpack-dev-server</strong> mediante esta orden:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> npx webpack-dev-server --env.output debug --contentBase <span class="k">$(</span>realpath .<span class="k">)</span>
</pre></div>
</div>
<p>podremos ver la página en la dirección:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>http://localhost:8080/examples
</pre></div>
</div>
<p>Podríamos trasladar esta forma de arrancar el servidor a la configuración, pero
hay un problema y es la segunda razón por la que es interesante el ejemplo: la
depuración durante el desarrollo. Al estar constituido el ejemplo por ficheros
estáticos accesibles al servidor a través de la opción <em>contentBase</em>, sólo se
mandará orden de recarga cuando se cambie el código del plugin (que sí se genera
con <strong class="program">webpack</strong>, pero no cuando cambie el código del ejemplo; y lo
interesante es que la recarga se produzca ante cualquier cambio.</p>
<p>La solución viene de la mano del plugin de <strong class="program">webpack</strong> <a class="reference external" href="https://github.com/webpack-contrib/copy-webpack-plugin">CopyPlugin</a> que le
facilita copiar en crudo ficheros y directorios. La estrategia es copiar
<code class="file docutils literal notranslate"><span class="pre">examples</span></code>, porque de este modo sí se procesará el contenido y, en
consecuencia, cualquier cambio en él también provocará la recarga de la página.
Lo primero es instalar el plugin:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> npm install --save-dev copy-webpack-plugin
</pre></div>
</div>
<p>Y, lo siguiente, alterar <a class="reference download internal" download="" href="../_downloads/c03f232ca561853b19376ae67224c0ad/webpack.development.js"><code class="xref download docutils literal notranslate"><span class="pre">webpack/webpack.development.js</span></code></a>:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="c1">// webpack/webpack.development.js</span>
<span class="kr">const</span> <span class="nx">merge</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;webpack-merge&#39;</span><span class="p">),</span>
<span class="hll">      <span class="nx">CopyPlugin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;copy-webpack-plugin&#39;</span><span class="p">),</span>
</span>      <span class="nx">webpack</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;webpack&quot;</span><span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">env</span> <span class="p">=&gt;</span> <span class="p">{</span>
   <span class="kr">const</span> <span class="nx">common</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./webpack.common.js&#39;</span><span class="p">)(</span><span class="nx">env</span><span class="p">);</span>
   <span class="kd">let</span> <span class="nx">filenamemap</span> <span class="o">=</span> <span class="sb">`</span><span class="si">${</span><span class="nx">common</span><span class="p">.</span><span class="nx">output</span><span class="p">.</span><span class="nx">filename</span><span class="si">}</span><span class="sb">.map`</span><span class="p">;</span>
<span class="hll">   <span class="k">if</span><span class="p">(</span><span class="nx">env</span><span class="p">.</span><span class="nx">output</span> <span class="o">===</span> <span class="s2">&quot;debug&quot;</span><span class="p">)</span> <span class="nx">filenamemap</span> <span class="o">=</span> <span class="sb">`dist/</span><span class="si">${</span><span class="nx">filenamemap</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
</span>
   <span class="kr">const</span> <span class="nx">config</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">mode</span><span class="o">:</span> <span class="s2">&quot;development&quot;</span><span class="p">,</span>
      <span class="nx">devtool</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
<span class="hll">      <span class="nx">devServer</span><span class="o">:</span> <span class="p">{</span>
</span><span class="hll">         <span class="nx">contentBase</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span><span class="hll">         <span class="nx">open</span><span class="o">:</span> <span class="s2">&quot;chromium&quot;</span><span class="p">,</span>
</span><span class="hll">         <span class="c1">//openPage: &quot;index.html&quot;</span>
</span><span class="hll">      <span class="p">},</span>
</span>      <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
         <span class="k">new</span> <span class="nx">webpack</span><span class="p">.</span><span class="nx">SourceMapDevToolPlugin</span><span class="p">({</span>
            <span class="nx">filename</span><span class="o">:</span> <span class="nx">filenamemap</span>
         <span class="p">})</span>
      <span class="p">]</span>
   <span class="p">};</span>
<span class="hll">
</span><span class="hll">   <span class="kr">const</span> <span class="nx">config_extra</span> <span class="o">=</span> <span class="nx">env</span><span class="p">.</span><span class="nx">output</span> <span class="o">!==</span> <span class="s2">&quot;debug&quot;</span><span class="o">?</span><span class="p">{}</span><span class="o">:</span>
</span><span class="hll">      <span class="p">{</span>
</span><span class="hll">         <span class="nx">output</span><span class="o">:</span> <span class="p">{</span>
</span><span class="hll">            <span class="nx">filename</span><span class="o">:</span> <span class="sb">`dist/</span><span class="si">${</span><span class="nx">common</span><span class="p">.</span><span class="nx">output</span><span class="p">.</span><span class="nx">filename</span><span class="si">}</span><span class="sb">`</span>
</span><span class="hll">         <span class="p">},</span>
</span><span class="hll">         <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
</span><span class="hll">            <span class="k">new</span> <span class="nx">CopyPlugin</span><span class="p">([</span>
</span><span class="hll">               <span class="p">{</span><span class="nx">from</span><span class="o">:</span> <span class="s2">&quot;examples&quot;</span><span class="p">,</span> <span class="nx">to</span><span class="o">:</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="nx">ignore</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;*.swp&quot;</span><span class="p">]</span> <span class="p">}</span>
</span><span class="hll">            <span class="p">])</span>
</span><span class="hll">         <span class="p">]</span>
</span>      <span class="p">}</span>

   <span class="k">return</span> <span class="nx">merge</span><span class="p">(</span><span class="nx">common</span><span class="p">,</span> <span class="nx">config</span><span class="p">,</span> <span class="nx">config_extra</span><span class="p">);</span>

<span class="p">}</span>
</pre></div>
</div>
<p>El fichero se ha modificado exclusivamente para modelar cómo se comporta
<em>webpack</em> en el sabor <em>debug</em> y las claves de los cambios son:</p>
<ul>
<li><p class="first"><a class="reference external" href="https://github.com/webpack-contrib/copy-webpack-plugin">CopyPlugin</a> copia el contenido de <code class="file docutils literal notranslate"><span class="pre">examples/</span></code> en el propio directorio
virtual, pero obviando los ficheros de backup de <strong class="program">vi</strong> para evitar
que, si se usa este editor, el proceso de edición provoque la continua
recarga de la página. Si se usa otra herramienta para el desarrollo, es
probable que deba cambiar la lista de ignorados.</p>
</li>
<li><p class="first">También en el directorio virtual se generían los ficheros resultantes de la
transformación del plugin, pero en el ejemplo se encuentra escrito:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="c">&lt;!-- Plugin --&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;../dist/leaflet.iconzoom.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>Para que siga funcionando en este sabor el enlace, es necesario modificar la
salida y añadir <code class="file docutils literal notranslate"><span class="pre">dist/</span></code> antes del nombre.</p>
</li>
<li><p class="first">En <a class="reference internal" href="#webpack-plugin-webpack-common-js"><span class="std std-ref">webpack/webpack.common.js</span></a> hay un
detalle que es conveniente aclarar ahora: el nombre del fichero resultante
para el sabor <em>min</em> y <em>debug</em> es el mismo, lo que provoca que, cuando se
visite el ejemplo durante la depuración podamos seguir la ejecución del código
en los ficheros originales, mientras que cuando se visita el ejemplo a través
de las páginas de <a class="reference external" href="https://github.com">Github</a>, se utiliza el código optimizado.</p>
</li>
</ul>
<p>El resultado se encuentra en <a class="reference external" href="https://github.com/sio2sio2/leaflet.iconzoom">su repositorio de Github</a> y en las páginas de <a class="reference external" href="https://github.com">Github</a> se
encuentra colgado <a class="reference external" href="https://sio2sio2.github.io/leaflet.iconzoom/examples">el ejemplo de uso</a>.</p>
<p class="rubric">Enlaces de interés</p>
<ul class="simple">
<li>En el interesante <a class="reference external" href="https://www.valentinog.com/blog/">blog de Valentino Gagliardi</a> hay una entrada de <a class="reference external" href="https://www.valentinog.com/blog/webpack/">introducción a
Webpack4</a> y otra para describir
<a class="reference external" href="https://www.valentinog.com/blog/from-gulp-to-webpack-4-tutorial/">cómo hacer con Webpack4 tareas que se hacen con Gulp</a> y que
puede informar de algunos aspectos adicionales a los explicados en la primera
entrada</li>
</ul>
<p class="rubric">Notas al pie</p>
<table class="docutils footnote" frame="void" id="id14" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>Por lo general, los que saben de esto suelen recomendar el uso de
<strong class="program">webpack</strong>. Por ejemplo, éche un vistazo a <a class="reference external" href="https://openwebinars.net/blog/webpack-vs-gulp-comparacion-en-espanol-actualizado/">esta justificación</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id15" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td>Tengamos presente que <code class="code docutils literal notranslate"><span class="pre">__dirname</span></code> es <code class="file docutils literal notranslate"><span class="pre">webpack</span></code>, ya que la
configuración se encuentra en <code class="file docutils literal notranslate"><span class="pre">webpack/webpack.development.js</span></code>.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id16" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[3]</a></td><td><p class="first">Si se usa <code class="code docutils literal notranslate"><span class="pre">--open</span></code> sin argumento adicional:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;debug&quot;</span><span class="o">:</span> <span class="s2">&quot;webpack-dev-server --mode development --open&quot;</span>
</pre></div>
</div>
<p>tomará como valor <code class="code docutils literal notranslate"><span class="pre">true</span></code>. Sin embargo, puedo añadirse el navegador que
se quiere usar:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;debug&quot;</span><span class="o">:</span> <span class="s2">&quot;webpack-dev-server --mode development --open chromium&quot;</span>
</pre></div>
</div>
<p class="last">Se prefiere, no obstante, no incluir el argumento y darle valor a <em>open</em> a
través de la configuración.</p>
</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id17" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[4]</a></td><td><p class="first">En los sistemas <em>linux</em>, el navegador predefinido es el que se obtiene
así:</p>
<div class="last highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> xdg-settings get default-web-browser
<span class="go">firefox-esr.desktop</span>
</pre></div>
</div>
</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id18" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id5">[5]</a></td><td>Entiéndase que los dos scripts no tienen por qué corresponderse con dos
ficheros. Cada uno de ellos puede estar programado de forma modular y
componerse de múltiples ficheros.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id19" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id7">[6]</a></td><td><em>Transpilar</em> (y transpilación y transpilador) es un término
construido por analogía con el verbo <em>compilar</em>. De un modo análogo al que
<em class="dfn">compilar</em> sea convertir código de programación en código máquina,
<em class="dfn">transpilar</em> es traducir còdigo de programación a una versión distinta,
por ejemplo, a una más antigua para mantener la compatibilidad con versiones
más antiguas del intérprete. Traducir de <a class="reference external" href="https://coffeescript.org/#introduction">CoffeeScript</a> o <a class="reference external" href="https://www.typescriptlang.org/">TypeScript</a> a
<em>Javascript</em> también es <em>transpilar</em>.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id20" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id8">[7]</a></td><td>También podemos usar <strong class="program">postcss-loader</strong>, entre <strong class="program">css-loader</strong>
y <strong class="program">sass-loader</strong>, pero importa poco a efectos de esta discusión.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id21" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id9">[8]</a></td><td><p class="first">Las variables de entorno que se pasan de forma estándar (véase <em>NODE_ENV</em>
cuando se trataba <a class="reference internal" href="#babel"><span class="std std-ref">babel</span></a>) se encuentran disponibles en el
script a través de <code class="code docutils literal notranslate"><span class="pre">process.env</span></code>:</p>
<div class="last highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">HOME</span><span class="p">)</span>
</pre></div>
</div>
</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id22" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id10">[9]</a></td><td>A menos claro está que hayamos hecho una copia incluida en nuestro
desarrollo de ese módulo ajeno, porque el problema de las librerías de
terceros es que se encuentran alojadas fuera del directorio de trabajo (en
<code class="file docutils literal notranslate"><span class="pre">node_modules</span></code> o en el directorio global de instalación) y esa
localización no es alcanzable por un cliente web. Otra solución es usar el
plugin <a class="reference external" href="https://webpack.js.org/plugins/provide-plugin/">Provide</a>, que se explica a continuación.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id23" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id11">[10]</a></td><td>La necesidad de incluir los cuatro últimos paquetes se debe a que
nuestra intención es ser capaces de procesar el <abbr title="Cascading Style Sheets">CSS</abbr> de <a class="reference external" href="https://leafletjs.com">Leaflet</a> para
el script <em>bundle</em>, y tal fichero <em>refiere</em>, además, algunas imágenes.
Una alternativa a esta solución <strong class="program">MiniCssExtractPlugin</strong>+<strong class="program">css.loader</strong> es utilizar <strong class="program">file-loader</strong>+<strong class="program">extract-loader</strong>+<strong class="program">css-loader</strong>.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id24" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id12">[11]</a></td><td>Esta aparente excentricidad tiene una explicación totalmente ajena a la
aplicación en sí: entre otras alternativas, <a class="reference external" href="https://github.com">Github</a> permite publicar el
contenida del directorio <code class="file docutils literal notranslate"><span class="pre">/docs</span></code>, así que hay se almacena el resultado
para que éste se publique en la dirección
<a class="reference external" href="https://sio2sio2.github.io/test.iconizoom">https://sio2sio2.github.io/test.iconizoom</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id25" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id13">[12]</a></td><td>La elección no es arbitraria: es el directorio donde la <a class="reference external" href="https://leafletjs.com/2013/06/28/leaflet-plugin-authoring-guide.html#code">Guía de Leaflet</a>
prescribe que se dispongan los ejemplos.</td></tr>
</tbody>
</table>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">4. Programación en el cliente (Webpack)</a><ul>
<li><a class="reference internal" href="#instalacion">4.1. Instalación</a><ul>
<li><a class="reference internal" href="#paquetes">4.1.1. Paquetes</a></li>
<li><a class="reference internal" href="#bases-la-de-configuracion">4.1.2. Bases la de configuración</a></li>
<li><a class="reference internal" href="#desarrollo">4.1.3. Desarrollo</a></li>
<li><a class="reference internal" href="#aplicacion-simple">4.1.4. Aplicación simple</a></li>
</ul>
</li>
<li><a class="reference internal" href="#particularidades">4.2. Particularidades</a><ul>
<li><a class="reference internal" href="#cambiando-rutas">4.2.1. Cambiando rutas</a></li>
<li><a class="reference internal" href="#punto-de-entrada">4.2.2. Punto de entrada</a></li>
<li><a class="reference internal" href="#babel">4.2.3. Babel</a></li>
<li><a class="reference internal" href="#sass">4.2.4. <abbr title="Syntactically Awesome Style Sheets">SASS</abbr></a></li>
<li><a class="reference internal" href="#autoprefixer">4.2.5. Autoprefixer</a></li>
<li><a class="reference internal" href="#procesamiento-de-css">4.2.6. Procesamiento de <abbr title="Cascading Style Sheets">CSS</abbr></a></li>
<li><a class="reference internal" href="#imagenes">4.2.7. Imágenes</a></li>
<li><a class="reference internal" href="#multiples-entornos">4.2.8. Múltiples entornos</a></li>
<li><a class="reference internal" href="#carga-de-modulos">4.2.9. Carga de módulos</a><ul>
<li><a class="reference internal" href="#sistema-de-modulos">4.2.9.1. Sistema de módulos</a></li>
<li><a class="reference internal" href="#importacion-en-la-configuracion">4.2.9.2. Importación en la configuración</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#ejemplos">4.3. Ejemplos</a><ul>
<li><a class="reference internal" href="#plugin">4.3.1. Plugin</a></li>
<li><a class="reference internal" href="#aplicacion-web">4.3.2. Aplicación web</a></li>
<li><a class="reference internal" href="#plugin-con-ejemplo">4.3.3. Plugin con ejemplo</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Tema anterior</h4>
  <p class="topless"><a href="../03.node/03.modulos.html"
                        title="capítulo anterior">3.3. Módulos</a></p>
  <h4>Próximo tema</h4>
  <p class="topless"><a href="../05.server/index.html"
                        title="próximo capítulo">5. Programación en el servidor</a></p>
  <div role="note" aria-label="source link">
    <h3>Esta página</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/04.client/index.rst.txt"
            rel="nofollow">Mostrar el código</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Búsqueda rápida</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Ir a" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="Índice General"
             >índice</a></li>
        <li class="right" >
          <a href="../05.server/index.html" title="5. Programación en el servidor"
             >siguiente</a> |</li>
        <li class="right" >
          <a href="../03.node/03.modulos.html" title="3.3. Módulos"
             >anterior</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">documentación de Javascript - 0.1</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Derechos de autor 2019, José Miguel Sánchez Alés.
      Creado con <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.5.
    </div>
  </body>
</html>